<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>لوحة تحكم مركز الفارس للعناية بالرجل</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
    }

    /* Enhanced color scheme */
    :root {
      --primary-color: #2563eb;
      --primary-dark: #1e40af;
      --secondary-color: #06b6d4;
      --accent-color: #f59e0b;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
      --dark-color: #1f2937;
      --light-color: #f8fafc;
    }

    /* Login page enhancements */
    .login-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .login-card {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .login-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }

    .login-input {
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    .login-input:focus {
      background: white;
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .login-btn {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      transition: all 0.3s ease;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
    }

    .logo-animation {
      animation: logoFloat 3s ease-in-out infinite;
    }

    @keyframes logoFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    /* Enhanced dashboard cards */
    .dashboard-card {
      background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
    }

    .dashboard-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      border-color: var(--primary-color);
    }

    /* Modern buttons */
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--secondary-color) 0%, #0891b2 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(6, 182, 212, 0.3);
    }

    /* Enhanced form styling */
    .form-input {
      border: 2px solid #e2e8f0;
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
      background: #f8fafc;
    }

    .form-input:focus {
      border-color: var(--primary-color);
      background: white;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    /* Enhanced tables */
    .modern-table {
      background: white;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .modern-table th {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      font-weight: 600;
      padding: 1rem;
    }

    .modern-table td {
      padding: 0.875rem 1rem;
      border-bottom: 1px solid #f1f5f9;
    }

    .modern-table tbody tr:hover {
      background: #f8fafc;
    }

    /* Page sections */
    .page-section {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      border: 1px solid #e2e8f0;
    }

    /* Status badges */
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .status-success {
      background: #dcfce7;
      color: #166534;
    }

    .status-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .status-error {
      background: #fee2e2;
      color: #991b1b;
    }

    /* Enhanced navigation */
    .nav-btn {
      position: relative;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .nav-btn:hover {
      background: rgba(37, 99, 235, 0.1);
      color: var(--primary-color);
    }

    .nav-btn:before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
      width: 3px;
      background: var(--primary-color);
      border-radius: 0 3px 3px 0;
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .nav-btn:hover:before {
      transform: scaleY(1);
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .dashboard-card {
        padding: 1.5rem;
      }
      
      .page-section {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
    }

    /* Print styles */
    @media print {
      body * {
        visibility: hidden;
      }
      .printable-content,
      .printable-content * {
        visibility: visible;
      }
      .printable-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        font-size: 12px;
        font-family: "Cairo", sans-serif;
        direction: rtl;
        padding: 8px 10px;
        box-sizing: border-box;
        white-space: pre-wrap;
      }
      #printableReceipt, #printableReceipt * {
        visibility: visible;
      }
      #printableReceipt {
        position: absolute;
        left: 0;
        top: 0;
        width: 80mm;
        font-size: 12px;
        font-family: monospace, "Cairo", sans-serif;
        direction: rtl;
        padding: 8px;
        box-sizing: border-box;
      }
    }

    /* Animations */
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loading spinner */
    .spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Enhanced payroll section */
    .payroll-card {
      background: linear-gradient(145deg, #f0f9ff 0%, #e0f2fe 100%);
      border: 2px solid #0284c7;
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .formula-display {
      background: #1e293b;
      color: #f1f5f9;
      padding: 1rem;
      border-radius: 0.5rem;
      font-family: 'Courier New', monospace;
      margin: 1rem 0;
    }

    /* Icon colors for dashboard cards */
    .icon-blue { color: #3b82f6; }
    .icon-green { color: #10b981; }
    .icon-red { color: #ef4444; }
    .icon-yellow { color: #f59e0b; }
    .icon-purple { color: #8b5cf6; }
    .icon-pink { color: #ec4899; }
    .icon-teal { color: #14b8a6; }
    .icon-indigo { color: #6366f1; }
    .icon-orange { color: #f97316; }
    .icon-emerald { color: #059669; }
    .icon-cyan { color: #06b6d4; }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-white to-slate-100 min-h-screen flex flex-col">

  <!-- Enhanced Login Page -->
  <section class="login-bg flex items-center justify-center p-6" id="login">
    <div class="login-card rounded-3xl shadow-2xl p-10 w-full max-w-md">
      <div class="flex justify-center mb-8">
        <div class="logo-animation">
          <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg">
            <i class="fas fa-cut text-white text-2xl"></i>
          </div>
        </div>
      </div>
      
      <h1 class="text-4xl font-bold text-center mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
        مركز الفارس
      </h1>
      
      <h2 class="text-2xl font-bold mb-8 text-gray-600 text-center">
        ALFARIS
      </h2>
      
      <form class="space-y-6 w-full" id="form-login">
        <div>
          <label class="block mb-2 font-semibold text-gray-700" for="username">
            <i class="fas fa-user ml-2"></i>
            اسم المستخدم
          </label>
          <input
            class="login-input w-full border border-gray-300 rounded-xl px-5 py-4 focus:outline-none focus:ring-4 focus:ring-blue-400 text-lg placeholder-gray-400"
            id="username"
            name="username"
            placeholder="أدخل اسم المستخدم"
            required
            type="text"
          />
        </div>
        
        <div>
          <label class="block mb-2 font-semibold text-gray-700" for="password">
            <i class="fas fa-lock ml-2"></i>
            كلمة المرور
          </label>
          <div class="relative">
            <input
              class="login-input w-full border border-gray-300 rounded-xl px-5 py-4 focus:outline-none focus:ring-4 focus:ring-blue-400 text-lg placeholder-gray-400"
              id="password"
              name="password"
              placeholder="أدخل كلمة المرور"
              required
              type="password"
            />
            <button
              type="button"
              class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition"
              id="togglePassword"
            >
              <i class="fas fa-eye" id="eyeIcon"></i>
            </button>
          </div>
        </div>
        
        <div class="flex items-center justify-between text-sm">
          <button
            type="button"
            class="text-blue-600 hover:text-blue-800 focus:outline-none transition"
            id="forgotPasswordBtn"
          >
            <i class="fas fa-question-circle ml-1"></i>
            نسيت كلمة المرور؟
          </button>
          <button
            type="button"
            class="text-blue-600 hover:text-blue-800 focus:outline-none transition flex items-center"
            id="changePasswordBtn"
          >
            <i class="fas fa-key ml-1"></i>
            تغيير كلمة المرور
          </button>
        </div>
        
        <div>
          <button
            class="login-btn w-full text-white px-6 py-4 rounded-xl focus:outline-none font-bold text-xl shadow-lg flex items-center justify-center gap-3"
            type="submit"
          >
            <i class="fas fa-sign-in-alt"></i>
            تسجيل الدخول
          </button>
        </div>
        
        <div class="text-red-600 font-semibold text-center select-none hidden" id="loginError" role="alert">
        </div>
      </form>
      
      <div class="mt-8 text-center">
        <div class="text-blue-600 text-sm mb-2">
          <i class="fas fa-store ml-1"></i>
          مركز الفارس للعناية بالرجل
        </div>
        <div class="text-blue-500 text-xs">
          نظام إدارة متطور وآمن
        </div>
      </div>
    </div>
  </section>

  <!-- Change Password Modal -->
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" id="changePasswordModal">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6 mx-4">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-2xl font-bold text-gray-900">تغيير كلمة المرور</h3>
        <button
          id="closeChangePasswordModal"
          class="text-gray-500 hover:text-gray-700 focus:outline-none"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="changePasswordForm" class="space-y-4">
        <div>
          <label for="phoneInput" class="block mb-1 font-semibold text-gray-800">رقم الهاتف</label>
          <input
            type="tel"
            id="phoneInput"
            placeholder="أدخل رقم الهاتف"
            required
            class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-4 focus:ring-blue-400 text-lg"
          />
        </div>
        
        <div>
          <label for="oldPasswordInput" class="block mb-1 font-semibold text-gray-800">كلمة المرور القديمة</label>
          <input
            type="password"
            id="oldPasswordInput"
            placeholder="أدخل كلمة المرور القديمة"
            required
            class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-4 focus:ring-blue-400 text-lg"
          />
        </div>
        
        <div>
          <label for="newPasswordInput" class="block mb-1 font-semibold text-gray-800">كلمة المرور الجديدة</label>
          <input
            type="password"
            id="newPasswordInput"
            placeholder="أدخل كلمة المرور الجديدة"
            required
            class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-4 focus:ring-blue-400 text-lg"
            minlength="6"
          />
        </div>
        
        <div class="flex justify-between items-center">
          <button
            type="button"
            id="cancelChangePasswordBtn"
            class="px-6 py-3 rounded-lg bg-gray-300 hover:bg-gray-400 transition font-semibold focus:outline-none"
          >
            إلغاء
          </button>
          <button
            type="submit"
            class="px-6 py-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition font-semibold focus:outline-none flex items-center gap-2"
          >
            <i class="fas fa-key"></i>
            تغيير
          </button>
        </div>
        
        <div class="text-red-600 font-semibold text-center select-none hidden" id="changePasswordError" role="alert">
        </div>
        <div class="text-green-600 font-semibold text-center select-none hidden" id="changePasswordSuccess" role="alert">
        </div>
      </form>
    </div>
  </div>

  <!-- Main App Content -->
  <div class="hidden flex flex-col min-h-screen" id="appContent">
    <header class="bg-white shadow-lg p-4 flex items-center justify-between sticky top-0 z-30 border-b-2 border-blue-100">
      <h1 class="text-3xl font-extrabold text-gray-900 tracking-wide flex items-center gap-3 select-none">
        <i class="fas fa-chart-line text-blue-600"></i>
        لوحة تحكم مركز الفارس
      </h1>
      
      <nav class="hidden lg:flex space-x-4 text-gray-700 font-semibold">
        <button class="nav-btn text-green-600" data-page="home">الرئيسية</button>
        <button class="nav-btn text-red-600" data-page="expenses">المصروفات</button>
        <button class="nav-btn text-brown" data-page="salaries">الرواتب</button>
        <button class="nav-btn  text-black" data-page="payrollManagement">حساب الراتب</button>
        <button class="nav-btn text-yellow-600" data-page="withdrawals">السحب</button>
        <button class="nav-btn text-green-600" data-page="appointments">المواعيد</button>
        <button class="nav-btn text-blue-600" data-page="services">الخدمات</button>
        <button class="nav-btn  text-red-600" data-page="inventory">المخزون</button>
        <button class="nav-btn text-brown" data-page="reports">التقارير</button>
        <button class="nav-btn text-black" data-page="dailySalary">الراتب اليومي</button>
        <button class="nav-btn text-yellow-600" data-page="monthlySalary">الراتب الشهري</button>
        <button class="nav-btn text-green-600" data-page="posSection">نقاط البيع</button>
        <button class="nav-btn text-indigo-600" data-page="paymentSummary">ملخص الدفع</button>
        <button class="nav-btn text-red-600 flex items-center gap-2" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i>
          خروج
        </button>
      </nav>
      
      <button class="lg:hidden text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 rounded p-2" id="mobileMenuBtn">
        <i class="fas fa-bars text-2xl"></i>
      </button>
    </header>
    
    <!-- Mobile menu -->
    <div class="fixed top-0 right-0 h-full w-72 bg-white shadow-lg transform translate-x-full transition-transform z-40 lg:hidden" id="mobileMenu">
      <div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-blue-600 to-purple-600">
        <h2 class="text-xl font-bold text-white select-none">القائمة</h2>
        <button class="text-white focus:outline-none focus:ring-2 focus:ring-white rounded" id="mobileMenuClose">
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>
      
      <nav class="flex flex-col p-4 space-y-2 text-gray-700 font-semibold max-h-screen overflow-y-auto">
        <button class="nav-btn text-right" data-page="home">الرئيسية</button>
        <button class="nav-btn text-right" data-page="expenses">المصروفات</button>
        <button class="nav-btn text-right" data-page="salaries">الرواتب</button>
        <button class="nav-btn text-right" data-page="payrollManagement">حساب الراتب</button>
        <button class="nav-btn text-right" data-page="withdrawals">السحب</button>
        <button class="nav-btn text-right" data-page="appointments">المواعيد</button>
        <button class="nav-btn text-right" data-page="services">الخدمات</button>
        <button class="nav-btn text-right" data-page="inventory">المخزون</button>
        <button class="nav-btn text-right" data-page="reports">التقارير</button>
        <button class="nav-btn text-right" data-page="dailySalary">الراتب اليومي</button>
        <button class="nav-btn text-right" data-page="monthlySalary">الراتب الشهري</button>
        <button class="nav-btn text-right text-green-600" data-page="posSection">نقاط البيع</button>
        <button class="nav-btn text-right text-indigo-600" data-page="paymentSummary">ملخص الدفع</button>
        <button class="nav-btn text-right text-red-600 flex items-center gap-2 mt-4" id="mobileLogoutBtn">
          <i class="fas fa-sign-out-alt"></i>
          تسجيل الخروج
        </button>
      </nav>
    </div>
    
    <main class="flex-grow container mx-auto p-6 max-w-7xl overflow-auto">
      <!-- الرئيسية -->
      <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 fade-in" id="home">
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="expenses" role="button" tabindex="0">
          <i class="fas fa-wallet text-7xl icon-blue mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">المصروفات</h2>
          <p class="text-gray-600 text-center">إدارة وتتبع المصروفات المالية</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="salaries" role="button" tabindex="0">
          <i class="fas fa-money-check-alt text-7xl icon-green mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">الرواتب</h2>
          <p class="text-gray-600 text-center">إدارة رواتب الموظفين</p>
        </div>

        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="payrollManagement" role="button" tabindex="0">
          <i class="fas fa-calculator text-7xl icon-purple mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">حساب الراتب</h2>
          <p class="text-gray-600 text-center">حساب صافي الراتب بالمعادلة المتقدمة</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="withdrawals" role="button" tabindex="0">
          <i class="fas fa-hand-holding-usd text-7xl icon-red mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">السحب</h2>
          <p class="text-gray-600 text-center">إدارة عمليات السحب النقدي</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="appointments" role="button" tabindex="0">
          <i class="fas fa-calendar-alt text-7xl icon-yellow mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">المواعيد</h2>
          <p class="text-gray-600 text-center">جدولة وإدارة المواعيد</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="services" role="button" tabindex="0">
          <i class="fas fa-cut text-7xl icon-pink mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">الخدمات</h2>
          <p class="text-gray-600 text-center">قائمة الخدمات المقدمة</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="inventory" role="button" tabindex="0">
          <i class="fas fa-boxes text-7xl icon-teal mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">المخزون</h2>
          <p class="text-gray-600 text-center">إدارة المخزون والمنتجات</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="reports" role="button" tabindex="0">
          <i class="fas fa-chart-line text-7xl icon-indigo mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">التقارير</h2>
          <p class="text-gray-600 text-center">تقارير مفصلة عن الأداء</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="dailySalary" role="button" tabindex="0">
          <i class="fas fa-calendar-day text-7xl icon-orange mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">الراتب اليومي</h2>
          <p class="text-gray-600 text-center">حساب الرواتب اليومية</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="monthlySalary" role="button" tabindex="0">
          <i class="fas fa-calendar-check text-7xl icon-purple mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">الراتب الشهري</h2>
          <p class="text-gray-600 text-center">حساب الرواتب الشهرية</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="posSection" role="button" tabindex="0">
          <i class="fas fa-cash-register text-7xl icon-emerald mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">نقاط البيع</h2>
          <p class="text-gray-600 text-center">نظام إدارة المبيعات</p>
        </div>
        
        <div class="dashboard-card cursor-pointer rounded-xl shadow-lg p-6 flex flex-col items-center transition-all duration-300" data-page="paymentSummary" role="button" tabindex="0">
          <i class="fas fa-credit-card text-7xl icon-cyan mb-4"></i>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">ملخص الدفع</h2>
          <p class="text-gray-600 text-center">ملخص طرق الدفع</p>
        </div>
      </section>

      <!-- Payroll Management Page -->
      <section class="hidden fade-in" id="payrollManagement">
        <button class="btn-primary mb-6 flex items-center gap-2" id="backFromPayrollManagement">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-purple-600 inline-block pb-2">
            إدارة دفع الرواتب للموظفين
          </h2>

          <!-- Formula Display -->
          <div class="payroll-card">
            <h3 class="text-xl font-bold mb-4 text-blue-800">معادلة حساب صافي الراتب</h3>
            <div class="formula-display">
              صافي الراتب = (الراتب الشهري × النسبة%) + المبلغ الإضافي - السحب الشهري
            </div>
            <p class="text-sm text-gray-600 mt-2">
              * النسبة المئوية: نسبة من الراتب الأساسي (مثال: 100% = الراتب كاملاً، 50% = نصف الراتب)<br>
              * المبلغ الإضافي: أي مبالغ إضافية مثل البونص أو العلاوات<br>
              * السحب الشهري: إجمالي المبالغ المسحوبة خلال الشهر
            </p>
          </div>

          <!-- Payroll Form -->
          <form class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="payrollForm">
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="payrollWorker">
                <i class="fas fa-user ml-2 text-purple-600"></i>
                اسم الموظف
              </label>
              <select
                class="form-input w-full"
                id="payrollWorker"
                required
              >
                <option disabled selected value="">اختر الموظف</option>
              </select>
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="payrollBaseSalary">
                <i class="fas fa-coins ml-2 text-green-600"></i>
                الراتب الشهري الأساسي (ريال)
              </label>
              <input
                class="form-input w-full"
                id="payrollBaseSalary"
                min="0"
                placeholder="أدخل الراتب الأساسي"
                required
                step="0.01"
                type="number"
              />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="payrollPercentage">
                <i class="fas fa-percentage ml-2 text-blue-600"></i>
                النسبة المئوية (%)
              </label>
              <input
                class="form-input w-full"
                id="payrollPercentage"
                min="0"
                max="200"
                placeholder="مثال: 100"
                required
                step="0.01"
                type="number"
                value="100"
              />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="payrollAdditionalAmount">
                <i class="fas fa-plus ml-2 text-emerald-600"></i>
                المبلغ الإضافي (ريال)
              </label>
              <input
                class="form-input w-full"
                id="payrollAdditionalAmount"
                min="0"
                placeholder="بونص، علاوة، إلخ..."
                step="0.01"
                type="number"
                value="0"
              />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="payrollMonth">
                <i class="fas fa-calendar ml-2 text-orange-600"></i>
                الشهر والسنة
              </label>
              <input
                class="form-input w-full"
                id="payrollMonth"
                required
                type="month"
              />
            </div>
            
            <div class="md:col-span-2 lg:col-span-3 flex justify-end">
              <button
                class="btn-primary flex items-center gap-3 text-lg px-8 py-3"
                type="submit"
              >
                <i class="fas fa-calculator"></i>
                حساب وحفظ الراتب
              </button>
            </div>
          </form>

          <!-- Payroll Result Display -->
          <div class="payroll-card hidden" id="payrollResult">
            <h3 class="text-xl font-bold mb-4 text-green-800">نتيجة حساب الراتب</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="payrollResultContent">
              <!-- Results will be populated here -->
            </div>
          </div>
        </div>

        <!-- Payroll Records Table -->
        <div class="page-section">
          <h3 class="text-2xl font-bold mb-4 text-gray-900">سجل الرواتب المحسوبة</h3>
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>اسم الموظف</th>
                  <th>الراتب الأساسي</th>
                  <th>النسبة %</th>
                  <th>المبلغ الإضافي</th>
                  <th>السحب الشهري</th>
                  <th>صافي الراتب</th>
                  <th>الشهر</th>
                  <th>تاريخ الحساب</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="payrollTableBody">
                <!-- Table rows will be populated here -->
              </tbody>
            </table>
          </div>
          
          <div class="flex justify-end mt-4">
            <button id="deleteAllPayrollBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-trash-alt"></i>
              حذف جميع السجلات
            </button>
          </div>
        </div>
      </section>

      <!-- Expenses Page -->
      <section class="hidden fade-in" id="expenses">
        <button class="btn-primary mb-6 flex items-center gap-2" id="backFromExpenses">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-blue-600 inline-block pb-2">
            إدارة وتتبع المصروفات المالية
          </h2>
          
          <form class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6" id="expenseForm">
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="expenseDate">
                تاريخ المصروف
              </label>
              <input class="form-input w-full" id="expenseDate" required type="date" />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="expenseCategory">
                الفئة
              </label>
              <select class="form-input w-full" id="expenseCategory" required>
                <option disabled selected value="">اختر الفئة</option>
                <option value="إيجار">إيجار</option>
                <option value="مستلزمات">مستلزمات</option>
                <option value="فواتير">فواتير</option>
                <option value="أخرى">أخرى</option>
              </select>
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="expenseAmount">
                المبلغ (ريال)
              </label>
              <input
                class="form-input w-full"
                id="expenseAmount"
                min="0"
                placeholder="أدخل المبلغ"
                required
                step="0.01"
                type="number"
              />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="expenseDescription">
                الوصف
              </label>
              <input
                class="form-input w-full"
                id="expenseDescription"
                placeholder="وصف المصروف"
                type="text"
              />
            </div>
            
            <div class="md:col-span-4 flex justify-end">
              <button class="btn-primary flex items-center gap-3" type="submit">
                <i class="fas fa-plus"></i>
                إضافة مصروف
              </button>
            </div>
          </form>
        </div>
        
        <div class="page-section">
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>التاريخ</th>
                  <th>الفئة</th>
                  <th>المبلغ (ريال)</th>
                  <th>الوصف</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="expensesTableBody"></tbody>
            </table>
          </div>
          
          <div class="flex justify-end mt-4">
            <button id="deleteAllExpensesBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-trash-alt"></i>
              حذف الكل
            </button>
          </div>
        </div>
      </section>

      <!-- Salaries Page -->
      <section class="hidden fade-in" id="salaries">
        <button class="btn-secondary mb-6 flex items-center gap-2" id="backFromSalaries">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-green-600 inline-block pb-2">
            إدارة دفع الرواتب للموظفين
          </h2>
          
          <form class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6" id="salaryForm">
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="salaryWorker">
                اسم الموظف
              </label>
              <select class="form-input w-full" id="salaryWorker" required>
                <option disabled selected value="">اختر الموظف</option>
              </select>
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="salaryAmount">
                المبلغ (ريال)
              </label>
              <input
                class="form-input w-full"
                id="salaryAmount"
                min="0"
                placeholder="أدخل المبلغ"
                required
                step="0.01"
                type="number"
              />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="salaryDate">
                تاريخ الدفع
              </label>
              <input class="form-input w-full" id="salaryDate" required type="date" />
            </div>
            
            <div class="flex items-center gap-4">
              <button class="btn-secondary flex items-center gap-3" type="submit">
                <i class="fas fa-plus"></i>
                إضافة راتب
              </button>
            </div>
          </form>
        </div>
        
        <div class="page-section">
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>اسم الموظف</th>
                  <th>الراتب الإجمالي (ريال)</th>
                  <th>السحب الشهري (ريال)</th>
                  <th>صافي الراتب (ريال)</th>
                  <th>تاريخ الدفع</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="salariesTableBody"></tbody>
            </table>
          </div>
          
          <div class="flex justify-end mt-4">
            <button id="deleteAllSalariesBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-trash-alt"></i>
              حذف الكل
            </button>
          </div>
        </div>
      </section>

      <!-- Continue with other sections... (I'll include the complete implementation for all pages) -->
      
      <!-- Withdrawals Page -->
      <section class="hidden fade-in" id="withdrawals">
        <button class="bg-red-600 text-white px-5 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromWithdrawals">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-red-600 inline-block pb-2">
            إدارة عمليات السحب النقدي وحساب السحب الشهري
          </h2>
          
          <form class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6" id="withdrawalForm">
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="withdrawalDate">
                تاريخ السحب
              </label>
              <input class="form-input w-full" id="withdrawalDate" required type="date" />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="withdrawalWorker">
                اسم العامل
              </label>
              <select class="form-input w-full" id="withdrawalWorker" required>
                <option disabled selected value="">اختر العامل</option>
              </select>
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="withdrawalAmount">
                المبلغ (ريال)
              </label>
              <input
                class="form-input w-full"
                id="withdrawalAmount"
                min="0"
                placeholder="أدخل المبلغ"
                required
                step="0.01"
                type="number"
              />
            </div>
            
            <div class="flex items-center gap-4 col-span-2">
              <button class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3" type="submit">
                <i class="fas fa-plus"></i>
                إضافة سحب
              </button>
              <button
                class="bg-red-800 text-white px-6 py-3 rounded-lg hover:bg-red-900 transition focus:outline-none font-semibold flex items-center gap-3"
                id="calculateMonthlyWithdrawalsBtn"
                type="button"
              >
                <i class="fas fa-calculator"></i>
                حساب السحب الشهري
              </button>
            </div>
          </form>
        </div>
        
        <div class="page-section">
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>التاريخ</th>
                  <th>اسم العامل</th>
                  <th>المبلغ (ريال)</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="withdrawalsTableBody"></tbody>
            </table>
          </div>
          
          <div class="bg-red-50 border border-red-200 p-6 rounded-lg text-red-800 hidden mt-6" id="monthlyWithdrawalSummary">
            <h3 class="text-xl font-bold mb-4">ملخص السحب الشهري</h3>
            <div class="space-y-2 text-lg" id="monthlyWithdrawalContent"></div>
          </div>
          
          <div class="flex justify-end mt-4">
            <button id="deleteAllWithdrawalsBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-trash-alt"></i>
              حذف الكل
            </button>
          </div>
        </div>
      </section>

      <!-- Appointments Page -->
      <section class="hidden fade-in" id="appointments">
        <button class="bg-yellow-600 text-white px-5 py-3 rounded-lg hover:bg-yellow-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromAppointments">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-yellow-600 inline-block pb-2">
            جدولة وإدارة المواعيد
          </h2>
          
          <form class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6" id="appointmentForm">
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="appointmentDate">
                تاريخ الموعد
              </label>
              <input class="form-input w-full" id="appointmentDate" required type="date" />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="appointmentTime">
                وقت الموعد
              </label>
              <input class="form-input w-full" id="appointmentTime" required type="time" />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="appointmentCustomer">
                اسم العميل
              </label>
              <input
                class="form-input w-full"
                id="appointmentCustomer"
                placeholder="أدخل اسم العميل"
                required
                type="text"
              />
            </div>
            
            <div class="flex items-center gap-4">
              <button class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition focus:outline-none font-semibold flex items-center gap-3" type="submit">
                <i class="fas fa-plus"></i>
                إضافة موعد
              </button>
            </div>
          </form>
        </div>
        
        <div class="page-section">
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>التاريخ</th>
                  <th>الوقت</th>
                  <th>اسم العميل</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="appointmentsTableBody"></tbody>
            </table>
          </div>
          
          <div class="flex justify-end mt-4">
            <button id="deleteAllAppointmentsBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-trash-alt"></i>
              حذف الكل
            </button>
          </div>
        </div>
      </section>

      <!-- Services Page -->
      <section class="hidden fade-in" id="services">
        <button class="bg-pink-600 text-white px-5 py-3 rounded-lg hover:bg-pink-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromServices">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-pink-600 inline-block pb-2">
            قائمة الخدمات المقدمة للعملاء
          </h2>
          
          <form class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6" id="serviceForm">
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="serviceName">
                اسم الخدمة
              </label>
              <input
                class="form-input w-full"
                id="serviceName"
                placeholder="أدخل اسم الخدمة"
                required
                type="text"
              />
            </div>
            
            <div>
              <label class="block mb-2 font-semibold text-gray-800" for="servicePriceInput">
                السعر (ريال)
              </label>
              <input
                class="form-input w-full"
                id="servicePriceInput"
                min="0"
                placeholder="أدخل السعر"
                required
                step="0.01"
                type="number"
              />
            </div>
            
            <div class="flex items-center gap-4">
              <button class="bg-pink-600 text-white px-6 py-3 rounded-lg hover:bg-pink-700 transition focus:outline-none font-semibold flex items-center gap-3" type="submit">
                <i class="fas fa-plus"></i>
                إضافة خدمة
              </button>
            </div>
          </form>
        </div>
        
        <div class="page-section">
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>اسم الخدمة</th>
                  <th>السعر (ريال)</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="servicesTableBody"></tbody>
            </table>
          </div>
          
          <div class="flex justify-end mt-4">
            <button id="deleteAllServicesBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-trash-alt"></i>
              حذف الكل
            </button>
          </div>
        </div>
      </section>

      <!-- Enhanced Inventory Page -->
      <section class="hidden fade-in" id="inventory">
        <button class="bg-teal-600 text-white px-5 py-3 rounded-lg hover:bg-teal-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromInventory">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-teal-600 inline-block pb-2">
            إدارة المخزون والمنتجات مع تتبع الحركة
          </h2>

          <!-- Add New Item Form -->
          <div class="bg-gradient-to-r from-teal-50 to-blue-50 rounded-lg shadow p-6 mb-6 border border-teal-200">
            <h3 class="text-xl font-bold mb-4 text-teal-700">إضافة منتج جديد</h3>
            <form class="grid grid-cols-1 md:grid-cols-4 gap-6" id="inventoryForm">
              <div>
                <label class="block mb-2 font-semibold text-gray-800" for="productName">
                  اسم المنتج
                </label>
                <input
                  class="form-input w-full"
                  id="productName"
                  placeholder="أدخل اسم المنتج"
                  required
                  type="text"
                />
              </div>
              
              <div>
                <label class="block mb-2 font-semibold text-gray-800" for="productQuantity">
                  الكمية الأولية
                </label>
                <input
                  class="form-input w-full"
                  id="productQuantity"
                  min="0"
                  placeholder="أدخل الكمية"
                  required
                  step="1"
                  type="number"
                />
              </div>
              
              <div>
                <label class="block mb-2 font-semibold text-gray-800" for="productPrice">
                  السعر (ريال)
                </label>
                <input
                  class="form-input w-full"
                  id="productPrice"
                  min="0"
                  placeholder="أدخل السعر"
                  required
                  step="0.01"
                  type="number"
                />
              </div>
              
              <div class="flex items-center gap-4">
                <button class="bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 transition focus:outline-none font-semibold flex items-center gap-3" type="submit">
                  <i class="fas fa-plus"></i>
                  إضافة منتج
                </button>
              </div>
            </form>
          </div>

          <!-- Stock Movement Form -->
          <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg shadow p-6 mb-6 border border-orange-200">
            <h3 class="text-xl font-bold mb-4 text-orange-700">حركة المخزون</h3>
            <form class="grid grid-cols-1 md:grid-cols-5 gap-6" id="stockMovementForm">
              <div>
                <label class="block mb-2 font-semibold text-gray-800" for="movementProduct">
                  اختر المنتج
                </label>
                <select class="form-input w-full" id="movementProduct" required>
                  <option disabled selected value="">اختر المنتج</option>
                </select>
              </div>
              
              <div>
                <label class="block mb-2 font-semibold text-gray-800" for="movementType">
                  نوع الحركة
                </label>
                <select class="form-input w-full" id="movementType" required>
                  <option disabled selected value="">اختر نوع الحركة</option>
                  <option value="add">إضافة مخزون</option>
                  <option value="withdraw">سحب من المخزون</option>
                </select>
              </div>
              
              <div>
                <label class="block mb-2 font-semibold text-gray-800" for="movementQuantity">
                  الكمية
                </label>
                <input
                  class="form-input w-full"
                  id="movementQuantity"
                  min="1"
                  placeholder="أدخل الكمية"
                  required
                  step="1"
                  type="number"
                />
              </div>
              
              <div>
                <label class="block mb-2 font-semibold text-gray-800" for="movementNote">
                  ملاحظة
                </label>
                <input
                  class="form-input w-full"
                  id="movementNote"
                  placeholder="ملاحظة اختيارية"
                  type="text"
                />
              </div>
              
              <div class="flex items-center gap-4">
                <button class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition focus:outline-none font-semibold flex items-center gap-3" type="submit">
                  <i class="fas fa-exchange-alt"></i>
                  تنفيذ الحركة
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Inventory Table -->
        <div class="page-section">
          <h3 class="text-xl font-bold mb-4 text-teal-600">المخزون الحالي</h3>
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>اسم المنتج</th>
                  <th>إجمالي المضاف</th>
                  <th>إجمالي المسحوب</th>
                  <th>الرصيد الحالي</th>
                  <th>السعر (ريال)</th>
                  <th>حالة المخزون</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="inventoryTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Stock Movement History -->
        <div class="page-section">
          <h3 class="text-xl font-bold mb-4 text-gray-600">سجل حركة المخزون</h3>
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>التاريخ</th>
                  <th>المنتج</th>
                  <th>نوع الحركة</th>
                  <th>الكمية</th>
                  <th>الملاحظة</th>
                  <th>إجراء</th>
                </tr>
              </thead>
              <tbody id="stockMovementTableBody"></tbody>
            </table>
          </div>
          
          <div class="flex justify-end mt-4 gap-4">
            <button id="deleteAllMovementsBtn" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-history"></i>
              حذف سجل الحركة
            </button>
            <button id="deleteAllInventoryBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
              <i class="fas fa-trash-alt"></i>
              حذف الكل
            </button>
          </div>
        </div>
      </section>

      <!-- Reports Page -->
      <section class="hidden fade-in" id="reports">
        <button class="bg-indigo-600 text-white px-5 py-3 rounded-lg hover:bg-indigo-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromReports">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-3xl font-bold text-gray-900 border-b-4 border-indigo-600 inline-block pb-2">
            عرض تقارير مفصلة عن الأداء
          </h2>
          <button
            id="printAllReportsBtn"
            class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition focus:outline-none font-semibold flex items-center gap-3"
          >
            <i class="fas fa-print"></i>
            طباعة جميع التقارير
          </button>
        </div>
        
        <div class="space-y-6">
          <!-- Expenses Report -->
          <div class="page-section">
            <h3 class="text-xl font-bold mb-4 text-gray-900">تقرير المصروفات</h3>
            <p class="text-gray-700 mb-4">إجمالي المصروفات: <span class="font-bold text-blue-600" id="totalExpenses">0.00</span> ريال</p>
            <div class="overflow-x-auto">
              <table class="modern-table w-full">
                <thead>
                  <tr>
                    <th>الفئة</th>
                    <th>المبلغ (ريال)</th>
                  </tr>
                </thead>
                <tbody id="expenseReportBody"></tbody>
              </table>
            </div>
          </div>

          <!-- Salaries Report -->
          <div class="page-section">
            <h3 class="text-xl font-bold mb-4 text-gray-900">تقرير الرواتب</h3>
            <p class="text-gray-700 mb-4">إجمالي الرواتب المدفوعة: <span class="font-bold text-green-600" id="totalSalaries">0.00</span> ريال</p>
            <div class="overflow-x-auto">
              <table class="modern-table w-full">
                <thead>
                  <tr>
                    <th>اسم الموظف</th>
                    <th>المبلغ (ريال)</th>
                  </tr>
                </thead>
                <tbody id="salaryReportBody"></tbody>
              </table>
            </div>
          </div>

          <!-- Withdrawals Report -->
          <div class="page-section">
            <h3 class="text-xl font-bold mb-4 text-gray-900">تقرير السحب</h3>
            <p class="text-gray-700 mb-4">إجمالي السحب: <span class="font-bold text-red-600" id="totalWithdrawals">0.00</span> ريال</p>
            <div class="overflow-x-auto">
              <table class="modern-table w-full">
                <thead>
                  <tr>
                    <th>اسم العامل</th>
                    <th>الشهر</th>
                    <th>المبلغ (ريال)</th>
                  </tr>
                </thead>
                <tbody id="withdrawalReportBody"></tbody>
              </table>
            </div>
          </div>

          <!-- Invoices Report -->
          <div class="page-section">
            <h3 class="text-xl font-bold mb-4 text-gray-900">تقرير الفواتير</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
              <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                <p class="text-sm text-blue-600 font-semibold">عدد الفواتير</p>
                <p class="text-2xl font-bold text-blue-800" id="totalInvoicesCount">0</p>
              </div>
              <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                <p class="text-sm text-green-600 font-semibold">إجمالي المبيعات</p>
                <p class="text-2xl font-bold text-green-800" id="totalInvoicesAmount">0.00 ريال</p>
              </div>
              <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                <p class="text-sm text-yellow-600 font-semibold">مبيعات كاش</p>
                <p class="text-2xl font-bold text-yellow-800" id="totalCashInvoices">0.00 ريال</p>
              </div>
              <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                <p class="text-sm text-purple-600 font-semibold">مبيعات فيزا</p>
                <p class="text-2xl font-bold text-purple-800" id="totalVisaInvoices">0.00 ريال</p>
              </div>
            </div>
            
            <h4 class="text-lg font-bold mb-2 text-gray-900">مبيعات حسب العامل</h4>
            <div class="overflow-x-auto">
              <table class="modern-table w-full">
                <thead>
                  <tr>
                    <th>اسم العامل</th>
                    <th>إجمالي المبيعات (ريال)</th>
                  </tr>
                </thead>
                <tbody id="invoiceWorkerReportBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Daily Salary Page -->
      <section class="hidden fade-in" id="dailySalary">
        <button class="bg-orange-600 text-white px-5 py-3 rounded-lg hover:bg-orange-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromDailySalary">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-orange-600 inline-block pb-2">
            حساب الراتب اليومي للعمال بناءً على الفواتير المسجلة
          </h2>
          
          <form class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6" id="dailySalaryForm">
            <div>
              <label for="dailyWorkerSelect" class="block mb-2 font-semibold text-gray-800">اختر اسم العامل</label>
              <select id="dailyWorkerSelect" class="form-input w-full" required>
                <option disabled selected value="">اختر العامل</option>
              </select>
            </div>
            
            <div>
              <label for="dailyDateInput" class="block mb-2 font-semibold text-gray-800">التاريخ</label>
              <input type="date" id="dailyDateInput" class="form-input w-full" required />
            </div>
            
            <div class="md:col-span-3 flex justify-end">
              <button type="submit" class="bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition focus:outline-none font-semibold flex items-center gap-3">
                <i class="fas fa-calculator"></i>
                حساب الراتب اليومي
              </button>
            </div>
          </form>
        </div>
        
        <div class="page-section bg-orange-50 border border-orange-200" id="dailySalaryResult">
          <h3 class="text-xl font-bold mb-4 text-orange-800">نتيجة حساب الراتب اليومي</h3>
          <p id="dailySalaryText" class="text-lg whitespace-pre-line text-orange-900"></p>
        </div>
        
        <div class="flex justify-end mt-4">
          <button id="deleteAllDailySalaryBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
            <i class="fas fa-trash-alt"></i>
            حذف الكل
          </button>
        </div>
      </section>

      <!-- Monthly Salary Page -->
      <section class="hidden fade-in" id="monthlySalary">
        <button class="bg-purple-600 text-white px-5 py-3 rounded-lg hover:bg-purple-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromMonthlySalary">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-purple-600 inline-block pb-2">
            حساب الراتب الشهري للعمال
          </h2>
          
          <form class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6" id="monthlySalaryForm">
            <div>
              <label for="monthlyWorkerSelect" class="block mb-2 font-semibold text-gray-800">اختر اسم العامل</label>
              <select id="monthlyWorkerSelect" class="form-input w-full" required>
                <option disabled selected value="">اختر العامل</option>
              </select>
            </div>
            
            <div>
              <label for="monthlyYearInput" class="block mb-2 font-semibold text-gray-800">السنة</label>
              <input type="number" id="monthlyYearInput" class="form-input w-full" min="2000" max="2100" placeholder="مثال: 2024" required />
            </div>
            
            <div>
              <label for="monthlyMonthInput" class="block mb-2 font-semibold text-gray-800">الشهر</label>
              <select id="monthlyMonthInput" class="form-input w-full" required>
                <option disabled selected value="">اختر الشهر</option>
                <option value="01">يناير</option>
                <option value="02">فبراير</option>
                <option value="03">مارس</option>
                <option value="04">أبريل</option>
                <option value="05">مايو</option>
                <option value="06">يونيو</option>
                <option value="07">يوليو</option>
                <option value="08">أغسطس</option>
                <option value="09">سبتمبر</option>
                <option value="10">أكتوبر</option>
                <option value="11">نوفمبر</option>
                <option value="12">ديسمبر</option>
              </select>
            </div>
            
            <div class="md:col-span-3 flex justify-end">
              <button type="submit" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition focus:outline-none font-semibold flex items-center gap-3">
                <i class="fas fa-calculator"></i>
                حساب الراتب الشهري
              </button>
            </div>
          </form>
        </div>
        
        <div class="page-section bg-purple-50 border border-purple-200 hidden" id="monthlySalaryResult">
          <h3 class="text-xl font-bold mb-4 text-purple-800">نتيجة حساب الراتب الشهري</h3>
          <p id="monthlySalaryText" class="text-lg whitespace-pre-line text-purple-900"></p>
        </div>
        
        <div class="flex justify-end mt-4">
          <button id="deleteAllMonthlySalaryBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
            <i class="fas fa-trash-alt"></i>
            حذف الكل
          </button>
        </div>
      </section>

      <!-- POS Section -->
      <section class="hidden fade-in" id="posSection">
        <button class="bg-emerald-700 text-white px-5 py-3 rounded-lg hover:bg-emerald-800 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromPOSBtn">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-4 flex flex-col lg:flex-row gap-4">
          <!-- Left side: product grid -->
          <div class="w-full lg:w-1/3 bg-gray-50 rounded-lg p-3 flex flex-col">
            <!-- Search input -->
            <input
              class="mb-3 rounded border border-gray-300 p-2 text-sm text-right placeholder-gray-400"
              id="searchInput"
              placeholder="بحث عن خدمة أو منتج..."
              type="text"
            />
            <!-- Product grid -->
            <div class="grid grid-cols-2 lg:grid-cols-3 gap-2 overflow-y-auto max-h-96" id="productGrid"></div>
            <button
              class="mt-auto bg-blue-600 text-white text-sm rounded py-2 px-3 w-full hover:bg-blue-700 transition"
              id="showMoreBtn"
            >
              عرض المزيد
            </button>
          </div>
          
          <!-- Right side: main content -->
          <div class="w-full lg:w-2/3 bg-white rounded-lg p-4 flex flex-col">
            <!-- Top bar -->
            <div class="flex flex-col lg:flex-row justify-between items-center mb-3 text-sm text-gray-600 gap-2">
              <div class="font-semibold">فاتورة رقم 000000000000</div>
              <div class="flex gap-2 flex-wrap w-full lg:w-auto justify-center lg:justify-start">
                <input
                  class="form-input text-sm w-full lg:w-40"
                  id="workerName"
                  placeholder="اسم العامل"
                  type="text"
                />
                <input
                  class="form-input text-sm w-full lg:w-40"
                  id="customerName"
                  placeholder="اسم العميل"
                  type="text"
                />
              </div>
            </div>
            
            <!-- Payment method selection -->
            <div class="mb-3 flex gap-4 items-center text-sm text-gray-700">
              <label for="paymentMethod" class="font-semibold">طريقة الدفع:</label>
              <select id="paymentMethod" class="form-input text-sm">
                <option value="cash" selected>كاش</option>
                <option value="visa">فيزا</option>
              </select>
            </div>
            
            <!-- Table header -->
            <div class="grid grid-cols-6 gap-2 text-sm font-semibold text-gray-700 border-b border-gray-300 pb-2 mb-2">
              <div>المنتج</div>
              <div>الكمية</div>
              <div>السعر</div>
              <div>الخصم</div>
              <div>الإجمالي</div>
              <div></div>
            </div>
            
            <!-- Table rows container -->
            <div class="flex flex-col gap-1 max-h-64 overflow-y-auto" id="invoiceItems"></div>
            
            <!-- Add product input -->
            <div class="flex items-center gap-2 mt-3 text-sm">
              <input
                class="flex-grow form-input text-sm"
                id="addProductInput"
                placeholder="أضف منتج أو خدمة"
                type="text"
              />
              <input
                class="w-24 form-input text-sm"
                id="manualPriceInput"
                placeholder="السعر"
                type="number"
                min="0"
                step="0.01"
              />
              <button
                class="bg-blue-600 text-white rounded px-4 py-2 text-sm hover:bg-blue-700 transition"
                id="addProductByNameBtn"
              >
                إضافة
              </button>
            </div>
            
            <!-- Bottom summary and buttons -->
            <div class="mt-auto flex flex-wrap gap-2 justify-between items-center pt-3 border-t border-gray-300 text-sm">
              <div class="text-green-600 font-bold text-lg" id="totalAmount">المجموع: 0.00 ريال</div>
              <div class="flex gap-2 flex-wrap">
                <button
                  class="bg-red-600 text-white rounded px-4 py-2 hover:bg-red-700 transition"
                  id="clearInvoiceBtn"
                >
                  إلغاء
                </button>
                <button
                  class="bg-green-600 text-white rounded px-4 py-2 hover:bg-green-700 transition"
                  id="completeSaleBtn"
                >
                  إتمام البيع
                </button>
                <button
                  class="bg-gray-600 text-white rounded px-4 py-2 hover:bg-gray-700 transition"
                  id="showInvoiceLogBtn"
                >
                  سجل الفواتير
                </button>
              </div>
            </div>
            
            <!-- Invoice Log Section -->
            <div class="mt-4 overflow-auto max-h-64 rounded-lg border border-gray-300 bg-gray-50 shadow p-2 hidden" id="invoiceLogSection">
              <h3 class="text-sm font-semibold text-gray-800 mb-2">سجل الفواتير</h3>
              <div class="overflow-x-auto">
                <table class="modern-table w-full">
                  <thead>
                    <tr>
                      <th>رقم الفاتورة</th>
                      <th>التاريخ</th>
                      <th>العامل</th>
                      <th>العميل</th>
                      <th>عدد العناصر</th>
                      <th>المجموع (ريال)</th>
                      <th>طريقة الدفع</th>
                      <th>إجراء</th>
                    </tr>
                  </thead>
                  <tbody id="invoiceLogTableBody"></tbody>
                </table>
              </div>
              <button class="mt-2 bg-red-600 text-white rounded px-3 py-1 text-xs hover:bg-red-700 transition focus:outline-none" id="closeInvoiceLogBtn">
                إغلاق السجل
              </button>
            </div>
            
            <div class="flex justify-end mt-4">
              <button id="deleteAllInvoicesBtn" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition focus:outline-none font-semibold flex items-center gap-3">
                <i class="fas fa-trash-alt"></i>
                حذف الكل
              </button>
            </div>
          </div>
        </div>
        
        <!-- Hidden printable receipt container -->
        <div id="printableReceipt" class="hidden p-2 bg-white shadow-md rounded" style="white-space: pre-line;"></div>
      </section>

      <!-- Payment Summary Page -->
      <section class="hidden fade-in" id="paymentSummary">
        <button class="bg-cyan-600 text-white px-5 py-3 rounded-lg hover:bg-cyan-700 transition focus:outline-none flex items-center gap-2 mb-6" id="backFromPaymentSummary">
          <i class="fas fa-arrow-right"></i>
          العودة للرئيسية
        </button>
        
        <div class="page-section">
          <h2 class="text-3xl font-bold mb-6 text-gray-900 border-b-4 border-cyan-600 inline-block pb-2">
            ملخص طرق الدفع
          </h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-6">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-lg font-semibold text-green-800">المدفوع كاش</h3>
                  <p class="text-3xl font-bold text-green-600" id="totalCashAmount">0.00 ريال</p>
                </div>
                <i class="fas fa-money-bill-wave text-4xl text-green-500"></i>
              </div>
            </div>
            
            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-lg font-semibold text-blue-800">المدفوع فيزا</h3>
                  <p class="text-3xl font-bold text-blue-600" id="totalVisaAmount">0.00 ريال</p>
                </div>
                <i class="fas fa-credit-card text-4xl text-blue-500"></i>
              </div>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="modern-table w-full">
              <thead>
                <tr>
                  <th>طريقة الدفع</th>
                  <th>المبلغ الإجمالي (ريال)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="flex items-center gap-2">
                    <i class="fas fa-money-bill-wave text-green-600"></i>
                    كاش
                  </td>
                  <td class="font-bold text-green-600" id="totalCashAmountTable">0.00</td>
                </tr>
                <tr>
                  <td class="flex items-center gap-2">
                    <i class="fas fa-credit-card text-blue-600"></i>
                    فيزا
                  </td>
                  <td class="font-bold text-blue-600" id="totalVisaAmountTable">0.00</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
    
    <footer class="bg-white shadow-inner p-4 text-center text-gray-600 text-sm border-t border-gray-200">
      <div class="flex flex-col md:flex-row justify-between items-center gap-2">
        <div class="flex items-center gap-2">
          <i class="fas fa-copyright text-blue-600"></i>
          <span>2025 جميع الحقوق محفوظة | مركز الفارس للعناية بالرجل</span>
        </div>
        <div class="flex items-center gap-2 text-blue-600">
          <i class="fas fa-code"></i>
          <span>تصميم وتطوير بواسطة Eng-A7med-ra</span>
        </div>
      </div>
    </footer>
  </div>

  <script>
    // Global variables
    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    let salaries = JSON.parse(localStorage.getItem('salaries')) || [];
    let payrollRecords = JSON.parse(localStorage.getItem('payrollRecords')) || [];
    let withdrawals = JSON.parse(localStorage.getItem('withdrawals')) || [];
    let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
    let servicesData = JSON.parse(localStorage.getItem('services')) || [];
    let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
    let stockMovements = JSON.parse(localStorage.getItem('stockMovements')) || [];
    let printedInvoices = JSON.parse(localStorage.getItem('salon_printed_invoices')) || [];

    // Workers data
    const workers = [
      { id: 'w1', name: 'ياسر العوضي' },
      { id: 'w2', name: 'علي الاتربي' },
      { id: 'w3', name: 'ابراهيم العزازي' },
      { id: 'w4', name: 'علي النجار' },
      { id: 'w5', name: 'الفلاح' },
      { id: 'w6', name: 'رضا' },
      { id: 'w7', name: 'ابراهيم' },
      { id: 'w8', name: 'السعيد' },
      { id: 'w9', name: 'السيد' },
    ];

    // Products data for POS
      const allProducts = [
      
      // Added new services
      { name: "حلاقة شعر + ذقن", price: 35, iconClass: "fas fa-cut", alt: "أيقونة حلاقة شعر وذقن", img: "https://placehold.co/60x60/png?text=حلاقة+شعر+وذقن" },
      { name: "حلاقة شعر نحته", price: 25, iconClass: "fas fa-cut", alt: "أيقونة حلاقة شعر نحته", img: "https://placehold.co/60x60/png?text=حلاقة+شعر+نحته" },
      { name: "حلاقة ذقن تحديد", price: 20, iconClass: "fas fa-beard", alt: "أيقونة حلاقة ذقن تحديد", img: "https://placehold.co/60x60/png?text=حلاقة+ذقن+تحديد" },
      { name: "حلاقة ذقن سكسوكه", price: 20, iconClass: "fas fa-beard", alt: "أيقونة حلاقة ذقن سكسوكه", img: "https://placehold.co/60x60/png?text=حلاقة+ذقن+سكسوكه" },
      { name: "حلاقة ذقن موس كامل", price: 15, iconClass: "fas fa-beard", alt: "أيقونة حلاقة ذقن موس كامل", img: "https://placehold.co/60x60/png?text=حلاقة+ذقن+موس+كامل" },
      { name: "حلاقة ذقن شعر طفل عادية", price: 20, iconClass: "fas fa-child", alt: "أيقونة حلاقة ذقن شعر طفل عادية", img: "https://placehold.co/60x60/png?text=حلاقة+ذقن+شعر+طفل" },
      { name: "استشوار", price: 20, iconClass: "fas fa-wind", alt: "أيقونة استشوار", img: "https://placehold.co/60x60/png?text=استشوار" },
      { name: "شمع", price: 25, iconClass: "fas fa-fire", alt: "أيقونة شمع", img: "https://placehold.co/60x60/png?text=شمع" },
      { name: "سنفرة عادية", price: 20, iconClass: "fas fa-hand-paper", alt: "أيقونة سنفرة عادية", img: "https://placehold.co/60x60/png?text=سنفرة+عادية" },
      { name: "قناع طين VIB", price: 50, iconClass: "fas fa-mask", alt: "أيقونة قناع طين VIB", img: "https://placehold.co/60x60/png?text=قناع+طين+VIB" },
      { name: "سنفرة مع فوطة حارة", price: 25, iconClass: "fas fa-hand-paper", alt: "أيقونة سنفرة مع فوطة حارة", img: "https://placehold.co/60x60/png?text=سنفرة+مع+فوطة+حارة" },
      { name: "سنفرة مع بخار", price: 30, iconClass: "fas fa-water", alt: "أيقونة سنفرة مع بخار", img: "https://placehold.co/60x60/png?text=سنفرة+مع+بخار" },
      { name: "نص تنظيف", price: 80, iconClass: "fas fa-broom", alt: "أيقونة نصف تنظيف", img: "https://placehold.co/60x60/png?text=نص+تنظيف" },
      { name: "صبغة بيجن", price: 40, iconClass: "fas fa-paint-brush", alt: "أيقونة صبغة بيجن", img: "https://placehold.co/60x60/png?text=صبغة+بيجن" },
      { name: "صبغة شامبو", price: 45, iconClass: "fas fa-paint-brush", alt: "أيقونة صبغة شامبو", img: "https://placehold.co/60x60/png?text=صبغة+شامبو" },
      { name: "صبغة ذقن", price: 30, iconClass: "fas fa-beard", alt: "أيقونة صبغة ذقن", img: "https://placehold.co/60x60/png?text=صبغة+ذقن" },
      { name: "قناع نعناع", price: 25, iconClass: "fas fa-leaf", alt: "أيقونة قناع نعناع", img: "https://placehold.co/60x60/png?text=قناع+نعناع" },
      { name: "قناع فلبيني", price: 50, iconClass: "fas fa-mask", alt: "أيقونة قناع فلبيني", img: "https://placehold.co/60x60/png?text=قناع+فلبيني" },
      { name: "معالج للقشرة", price: 120, iconClass: "fas fa-bug", alt: "أيقونة معالج للقشرة", img: "https://placehold.co/60x60/png?text=معالج+للقشرة" },
      { name: "معالج للشعر", price: 120, iconClass: "fas fa-spa", alt: "أيقونة معالج للشعر", img: "https://placehold.co/60x60/png?text=معالج+للشعر" },
      { name: "تنظيف كامل ليزر مع شفط دهون", price: 150, iconClass: "fas fa-laser", alt: "أيقونة تنظيف كامل ليزر مع شفط دهون", img: "https://placehold.co/60x60/png?text=تنظيف+ليزر+وشفط" },
      { name: "حمام مغربي", price: 150, iconClass: "fas fa-water", alt: "أيقونة حمام مغربي", img: "https://placehold.co/60x60/png?text=حمام+مغربي" },
      { name: "بروتين للشعر", price: 250, iconClass: "fas fa-flask", alt: "أيقونة بروتين للشعر", img: "https://placehold.co/60x60/png?text=بروتين+للشعر" },
      { name: "حمام زيت مع الجهاز", price: 40, iconClass: "fas fa-oil-can", alt: "أيقونة حمام زيت مع الجهاز", img: "https://placehold.co/60x60/png?text=حمام+زيت+مع+الجهاز" },
      { name: "حمام زيت عادي", price: 25, iconClass: "fas fa-oil-can", alt: "أيقونة حمام زيت عادي", img: "https://placehold.co/60x60/png?text=حمام+زيت+عادي" }
    ];
    // POS variables
    let invoiceItems = [];
    let showAll = false;

    // Authentication variables
    let validUser = JSON.parse(localStorage.getItem('validUser')) || {
      username: 'alfaris',
      password: '123456',
    };
    const phoneNumber = '01091889366';

    // DOM Elements
    const loginSection = document.getElementById('login');
    const appContent = document.getElementById('appContent');
    const formLogin = document.getElementById('form-login');
    const loginError = document.getElementById('loginError');
    const logoutBtn = document.getElementById('logoutBtn');
    const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');

    // Pages array
    const pages = [
      'home', 'expenses', 'salaries', 'payrollManagement', 'withdrawals', 'appointments', 
      'services', 'inventory', 'reports', 'dailySalary', 'monthlySalary', 
      'posSection', 'paymentSummary'
    ];

    // Utility Functions
    function saveValidUser() {
      localStorage.setItem('validUser', JSON.stringify(validUser));
    }

    function confirmPasswordPrompt() {
      const input = prompt('يرجى إدخال كلمة المرور لتأكيد الحذف:');
      if (input === null) return false;
      if (input === validUser.password) return true;
      alert('كلمة المرور غير صحيحة.');
      return false;
    }

    function showPage(pageId) {
      pages.forEach((p) => {
        const el = document.getElementById(p);
        if (el) {
          if (p === pageId) {
            el.classList.remove('hidden');
            el.scrollTop = 0;
          } else {
            el.classList.add('hidden');
          }
        }
      });
      
      // Close mobile menu if open
      const mobileMenu = document.getElementById('mobileMenu');
      if (!mobileMenu.classList.contains('translate-x-full')) {
        mobileMenu.classList.add('translate-x-full');
      }
      
      // Update page-specific data
      if (pageId === 'dailySalary') {
        autoDisplayDailySalary();
      }
      if (pageId === 'reports') {
        updateReports();
      }
      if (pageId === 'paymentSummary') {
        updatePaymentSummary();
      }
      if (pageId === 'inventory') {
        updateInventoryTable();
        updateStockMovementTable();
        populateProductSelect();
      }
      if (pageId === 'payrollManagement') {
        updatePayrollTable();
      }
    }

    function showApp() {
      loginSection.classList.add('hidden');
      appContent.classList.remove('hidden');
    }

    function showLogin() {
      loginSection.classList.remove('hidden');
      appContent.classList.add('hidden');
      formLogin.reset();
      loginError.textContent = '';
      loginError.classList.add('hidden');
    }

    function logout() {
      showLogin();
      showPage('home');
    }

    // Authentication Functions
    function initializeAuth() {
      // Password toggle
      const togglePassword = document.getElementById('togglePassword');
      const passwordInput = document.getElementById('password');
      const eyeIcon = document.getElementById('eyeIcon');
      
      togglePassword.addEventListener('click', () => {
        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          eyeIcon.className = 'fas fa-eye-slash';
        } else {
          passwordInput.type = 'password';
          eyeIcon.className = 'fas fa-eye';
        }
      });

      // Login form
      formLogin.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = e.target.username.value.trim();
        const password = e.target.password.value;

        if (!username || !password) {
          loginError.textContent = 'يرجى ملء جميع الحقول.';
          loginError.classList.remove('hidden');
          return;
        }

        if (username === validUser.username && password === validUser.password) {
          showApp();
        } else {
          loginError.textContent = 'اسم المستخدم أو كلمة المرور غير صحيحة';
          loginError.classList.remove('hidden');
        }
      });

      // Logout buttons
      logoutBtn.addEventListener('click', logout);
      mobileLogoutBtn.addEventListener('click', () => {
        logout();
        document.getElementById('mobileMenu').classList.add('translate-x-full');
      });

      // Forgot password
      document.getElementById('forgotPasswordBtn').addEventListener('click', () => {
        const userPhone = prompt('يرجى تسجيل رقم الهاتف لاستعادة كلمة المرور:');
        if (userPhone === null) return;
        
        const trimmedPhone = userPhone.trim();
        if (trimmedPhone === phoneNumber) {
          alert(`رقم الهاتف صحيح.\nكلمة المرور الخاصة بك هي: ${validUser.password}`);
        } else if (trimmedPhone === '') {
          alert('لم يتم إدخال رقم الهاتف.');
        } else {
          alert('رقم الهاتف غير صحيح. يرجى المحاولة مرة أخرى.');
        }
      });

      // Change password modal
      const changePasswordBtn = document.getElementById('changePasswordBtn');
      const changePasswordModal = document.getElementById('changePasswordModal');
      const closeChangePasswordModal = document.getElementById('closeChangePasswordModal');
      const cancelChangePasswordBtn = document.getElementById('cancelChangePasswordBtn');
      const changePasswordForm = document.getElementById('changePasswordForm');
      const changePasswordError = document.getElementById('changePasswordError');
      const changePasswordSuccess = document.getElementById('changePasswordSuccess');

      changePasswordBtn.addEventListener('click', () => {
        changePasswordError.classList.add('hidden');
        changePasswordSuccess.classList.add('hidden');
        changePasswordForm.reset();
        changePasswordModal.classList.remove('hidden');
        document.getElementById('phoneInput').focus();
      });

      closeChangePasswordModal.addEventListener('click', () => {
        changePasswordModal.classList.add('hidden');
        changePasswordError.classList.add('hidden');
        changePasswordSuccess.classList.add('hidden');
        changePasswordForm.reset();
      });

      cancelChangePasswordBtn.addEventListener('click', () => {
        changePasswordModal.classList.add('hidden');
        changePasswordError.classList.add('hidden');
        changePasswordSuccess.classList.add('hidden');
        changePasswordForm.reset();
      });

      changePasswordForm.addEventListener('submit', (e) => {
        e.preventDefault();
        changePasswordError.classList.add('hidden');
        changePasswordSuccess.classList.add('hidden');

        const phone = document.getElementById('phoneInput').value.trim();
        const oldPass = document.getElementById('oldPasswordInput').value;
        const newPass = document.getElementById('newPasswordInput').value;

        if (!phone || !oldPass || !newPass) {
          changePasswordError.textContent = 'يرجى ملء جميع الحقول.';
          changePasswordError.classList.remove('hidden');
          return;
        }
        if (phone !== phoneNumber) {
          changePasswordError.textContent = 'رقم الهاتف غير صحيح.';
          changePasswordError.classList.remove('hidden');
          return;
        }
        if (oldPass !== validUser.password) {
          changePasswordError.textContent = 'كلمة المرور القديمة غير صحيحة.';
          changePasswordError.classList.remove('hidden');
          return;
        }
        if (newPass.length < 6) {
          changePasswordError.textContent = 'كلمة المرور الجديدة يجب أن تكون 6 أحرف على الأقل.';
          changePasswordError.classList.remove('hidden');
          return;
        }
        if (newPass === oldPass) {
          changePasswordError.textContent = 'كلمة المرور الجديدة يجب أن تختلف عن القديمة.';
          changePasswordError.classList.remove('hidden');
          return;
        }

        validUser.password = newPass;
        saveValidUser();
        alert('تم تغيير كلمة المرور بنجاح. يرجى تسجيل الدخول باستخدام كلمة المرور الجديدة.');
        changePasswordModal.classList.add('hidden');
        changePasswordForm.reset();
        showLogin();
      });
    }

    // Navigation Functions
    function initializeNavigation() {
      // Mobile menu toggle
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const mobileMenu = document.getElementById('mobileMenu');
      const mobileMenuClose = document.getElementById('mobileMenuClose');

      mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.remove('translate-x-full');
      });

      mobileMenuClose.addEventListener('click', () => {
        mobileMenu.classList.add('translate-x-full');
      });

      // Header nav buttons
      document.querySelectorAll('header nav button:not(#logoutBtn)').forEach((btn) => {
        btn.addEventListener('click', () => {
          const page = btn.getAttribute('data-page');
          if (page) showPage(page);
        });
      });

      // Mobile nav buttons
      document.querySelectorAll('#mobileMenu nav button:not(#mobileLogoutBtn)').forEach((btn) => {
        btn.addEventListener('click', () => {
          const page = btn.getAttribute('data-page');
          if (page) showPage(page);
        });
      });

      // Home cards clickable
      document.querySelectorAll('#home > div[tabindex="0"]').forEach((card) => {
        card.addEventListener('click', () => {
          const page = card.getAttribute('data-page');
          if (page) showPage(page);
        });
        
        card.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const page = card.getAttribute('data-page');
            if (page) showPage(page);
          }
        });
      });

      // Back buttons
      pages.forEach((p) => {
        if (p === 'home') return;
        const backBtn = document.getElementById('backFrom' + p.charAt(0).toUpperCase() + p.slice(1));
        if (backBtn) {
          backBtn.addEventListener('click', () => {
            showPage('home');
          });
        }
      });
    }

    // Worker Select Population
    function populateWorkerSelects() {
      const selects = [
        'withdrawalWorker', 'salaryWorker', 'payrollWorker', 'dailyWorkerSelect', 'monthlyWorkerSelect'
      ];
      
      selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
          // Clear existing options except the first one
          while (select.children.length > 1) {
            select.removeChild(select.lastChild);
          }
          
          workers.forEach(worker => {
            const option = document.createElement('option');
            option.value = worker.id;
            option.textContent = worker.name;
            select.appendChild(option);
          });
        }
      });
    }

    // Payroll Management Functions
    function calculateMonthlyWithdrawalsForWorker(workerId, month) {
      return withdrawals
        .filter(wd => wd.workerId === workerId && wd.date.startsWith(month))
        .reduce((sum, wd) => sum + parseFloat(wd.amount), 0);
    }

    function updatePayrollTable() {
      const tbody = document.getElementById('payrollTableBody');
      if (!tbody) return;

      tbody.innerHTML = '';
      
      if (payrollRecords.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 9;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد سجلات رواتب محسوبة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      
      payrollRecords.forEach((record, index) => {
        const workerName = workers.find(w => w.id === record.workerId)?.name || 'غير معروف';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${workerName}</td>
          <td class="px-4 py-3">${parseFloat(record.baseSalary).toFixed(2)}</td>
          <td class="px-4 py-3">${parseFloat(record.percentage).toFixed(1)}%</td>
          <td class="px-4 py-3">${parseFloat(record.additionalAmount).toFixed(2)}</td>
          <td class="px-4 py-3">${parseFloat(record.monthlyWithdrawals).toFixed(2)}</td>
          <td class="px-4 py-3 font-bold ${record.netSalary < 0 ? 'text-red-600' : 'text-green-600'}">${parseFloat(record.netSalary).toFixed(2)}</td>
          <td class="px-4 py-3">${record.month}</td>
          <td class="px-4 py-3">${new Date(record.calculatedDate).toLocaleDateString('ar-EG')}</td>
          <td class="px-4 py-3 text-center">
            <button data-index="${index}" class="deletePayrollBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deletePayrollBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          payrollRecords.splice(idx, 1);
          localStorage.setItem('payrollRecords', JSON.stringify(payrollRecords));
          updatePayrollTable();
        });
      });
    }

    function initializePayrollManagement() {
      const payrollForm = document.getElementById('payrollForm');
      const payrollResult = document.getElementById('payrollResult');
      const payrollResultContent = document.getElementById('payrollResultContent');

      // Set current month as default
      const currentDate = new Date();
      const currentMonth = currentDate.getFullYear() + '-' + String(currentDate.getMonth() + 1).padStart(2, '0');
      document.getElementById('payrollMonth').value = currentMonth;

      payrollForm.addEventListener('submit', e => {
        e.preventDefault();
        
        const workerId = document.getElementById('payrollWorker').value;
        const baseSalary = parseFloat(document.getElementById('payrollBaseSalary').value);
        const percentage = parseFloat(document.getElementById('payrollPercentage').value);
        const additionalAmount = parseFloat(document.getElementById('payrollAdditionalAmount').value) || 0;
        const month = document.getElementById('payrollMonth').value;
        
        if (!workerId || isNaN(baseSalary) || isNaN(percentage) || !month) {
          alert('يرجى ملء جميع الحقول المطلوبة بشكل صحيح.');
          return;
        }

        if (baseSalary < 0 || percentage < 0 || additionalAmount < 0) {
          alert('لا يمكن أن تكون القيم المدخلة أقل من صفر.');
          return;
        }

        if (percentage > 200) {
          alert('النسبة المئوية لا يمكن أن تتجاوز 200%.');
          return;
        }

        // Calculate monthly withdrawals
        const monthlyWithdrawals = calculateMonthlyWithdrawalsForWorker(workerId, month);
        
        // Calculate net salary using the formula: (BaseSalary × Percentage%) + AdditionalAmount - MonthlyWithdrawals
        const salaryByPercentage = baseSalary * (percentage / 100);
        const netSalary = salaryByPercentage + additionalAmount - monthlyWithdrawals;

        // Create record
        const record = {
          workerId,
          baseSalary,
          percentage,
          additionalAmount,
          monthlyWithdrawals,
          netSalary,
          month,
          calculatedDate: new Date().toISOString()
        };

        // Save record
        payrollRecords.push(record);
        localStorage.setItem('payrollRecords', JSON.stringify(payrollRecords));

        // Display results
        const workerName = workers.find(w => w.id === workerId)?.name || 'غير معروف';
        payrollResultContent.innerHTML = `
          <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <p class="text-sm text-blue-600 font-semibold">اسم الموظف</p>
            <p class="text-lg font-bold text-blue-800">${workerName}</p>
          </div>
          <div class="bg-green-50 p-4 rounded-lg border border-green-200">
            <p class="text-sm text-green-600 font-semibold">الراتب بعد النسبة</p>
            <p class="text-lg font-bold text-green-800">${salaryByPercentage.toFixed(2)} ريال</p>
          </div>
          <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
            <p class="text-sm text-purple-600 font-semibold">المبلغ الإضافي</p>
            <p class="text-lg font-bold text-purple-800">${additionalAmount.toFixed(2)} ريال</p>
          </div>
          <div class="bg-red-50 p-4 rounded-lg border border-red-200">
            <p class="text-sm text-red-600 font-semibold">السحب الشهري</p>
            <p class="text-lg font-bold text-red-800">${monthlyWithdrawals.toFixed(2)} ريال</p>
          </div>
          <div class="md:col-span-2 lg:col-span-4 bg-gradient-to-r from-emerald-50 to-teal-50 p-6 rounded-lg border-2 border-emerald-300">
            <p class="text-lg text-emerald-700 font-semibold mb-2">صافي الراتب النهائي</p>
            <p class="text-3xl font-bold ${netSalary < 0 ? 'text-red-600' : 'text-emerald-600'}">${netSalary.toFixed(2)} ريال</p>
            <p class="text-sm text-gray-600 mt-2">
              المعادلة: (${baseSalary.toFixed(2)} × ${percentage}%) + ${additionalAmount.toFixed(2)} - ${monthlyWithdrawals.toFixed(2)} = ${netSalary.toFixed(2)}
            </p>
          </div>
        `;

        payrollResult.classList.remove('hidden');
        updatePayrollTable();
        payrollForm.reset();
        
        // Reset to current month
        document.getElementById('payrollMonth').value = currentMonth;
        document.getElementById('payrollPercentage').value = 100;
        document.getElementById('payrollAdditionalAmount').value = 0;
      });

      // Delete all payroll records
      document.getElementById('deleteAllPayrollBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع سجلات الرواتب المحسوبة؟ لا يمكن التراجع عن هذا الإجراء.')) {
          payrollRecords = [];
          localStorage.setItem('payrollRecords', JSON.stringify(payrollRecords));
          updatePayrollTable();
          payrollResult.classList.add('hidden');
        }
      });

      updatePayrollTable();
    }

    // Inventory Functions
    function getProductCurrentStock(productName) {
      const movements = stockMov

ements.filter(m => m.productName === productName);
      let totalAdded = 0;
      let totalWithdrawn = 0;
      
      movements.forEach(movement => {
        if (movement.type === 'add') {
          totalAdded += movement.quantity;
        } else if (movement.type === 'withdraw') {
          totalWithdrawn += movement.quantity;
        }
      });
      
      return {
        totalAdded,
        totalWithdrawn,
        currentStock: totalAdded - totalWithdrawn
      };
    }

    function getStockStatusClass(currentStock) {
      if (currentStock <= 5) return 'status-error';
      if (currentStock <= 20) return 'status-warning';
      return 'status-success';
    }

    function getStockStatusText(currentStock) {
      if (currentStock <= 0) return 'نفد المخزون';
      if (currentStock <= 5) return 'مخزون منخفض';
      if (currentStock <= 20) return 'مخزون متوسط';
      return 'مخزون جيد';
    }

    function updateInventoryTable() {
      const tbody = document.getElementById('inventoryTableBody');
      tbody.innerHTML = '';
      
      if (inventory.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 7;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد منتجات مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      
      inventory.forEach((item, index) => {
        const stockInfo = getProductCurrentStock(item.name);
        const statusClass = getStockStatusClass(stockInfo.currentStock);
        const statusText = getStockStatusText(stockInfo.currentStock);
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${item.name}</td>
          <td class="px-4 py-3 text-green-600 font-semibold">${stockInfo.totalAdded}</td>
          <td class="px-4 py-3 text-red-600 font-semibold">${stockInfo.totalWithdrawn}</td>
          <td class="px-4 py-3 font-bold">${stockInfo.currentStock}</td>
          <td class="px-4 py-3">${parseFloat(item.price).toFixed(2)}</td>
          <td class="px-4 py-3">
            <span class="status-badge ${statusClass}">${statusText}</span>
          </td>
          <td class="px-4 py-3 text-center">
            <button data-index="${index}" class="deleteInventoryBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deleteInventoryBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          const productName = inventory[idx].name;
          
          // Remove product from inventory
          inventory.splice(idx, 1);
          localStorage.setItem('inventory', JSON.stringify(inventory));
          
          // Remove all stock movements for this product
          stockMovements = stockMovements.filter(m => m.productName !== productName);
          localStorage.setItem('stockMovements', JSON.stringify(stockMovements));
          
          updateInventoryTable();
          updateStockMovementTable();
          populateProductSelect();
        });
      });
    }

    function updateStockMovementTable() {
      const tbody = document.getElementById('stockMovementTableBody');
      tbody.innerHTML = '';
      
      if (stockMovements.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد حركات مخزون مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      
      // Sort movements by date (newest first)
      const sortedMovements = [...stockMovements].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      sortedMovements.forEach((movement, index) => {
        const typeText = movement.type === 'add' ? 'إضافة' : 'سحب';
        const typeClass = movement.type === 'add' ? 'text-green-600' : 'text-red-600';
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${movement.date}</td>
          <td class="px-4 py-3">${movement.productName}</td>
          <td class="px-4 py-3 ${typeClass} font-semibold">${typeText}</td>
          <td class="px-4 py-3">${movement.quantity}</td>
          <td class="px-4 py-3">${movement.note || '-'}</td>
          <td class="px-4 py-3 text-center">
            <button data-index="${stockMovements.indexOf(movement)}" class="deleteMovementBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deleteMovementBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          stockMovements.splice(idx, 1);
          localStorage.setItem('stockMovements', JSON.stringify(stockMovements));
          updateStockMovementTable();
          updateInventoryTable();
        });
      });
    }

    function populateProductSelect() {
      const select = document.getElementById('movementProduct');
      if (!select) return;
      
      // Clear existing options except the first one
      while (select.children.length > 1) {
        select.removeChild(select.lastChild);
      }
      
      inventory.forEach(item => {
        const option = document.createElement('option');
        option.value = item.name;
        option.textContent = item.name;
        select.appendChild(option);
      });
    }

    function initializeInventory() {
      updateInventoryTable();
      updateStockMovementTable();
      populateProductSelect();
      
      // Add new product form
      const inventoryForm = document.getElementById('inventoryForm');
      inventoryForm.addEventListener('submit', e => {
        e.preventDefault();
        const name = document.getElementById('productName').value.trim();
        const quantity = parseInt(document.getElementById('productQuantity').value);
        const price = parseFloat(document.getElementById('productPrice').value);
        
        if (!name || isNaN(quantity) || quantity < 0 || isNaN(price) || price < 0) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }
        
        // Check if product already exists
        const existingIndex = inventory.findIndex(item => item.name.toLowerCase() === name.toLowerCase());
        if (existingIndex !== -1) {
          alert('هذا المنتج موجود بالفعل. استخدم نموذج حركة المخزون لإضافة كمية.');
          return;
        }
        
        // Add product to inventory
        inventory.push({ name, price });
        localStorage.setItem('inventory', JSON.stringify(inventory));
        
        // Add initial stock movement if quantity > 0
        if (quantity > 0) {
          const movement = {
            date: new Date().toISOString().split('T')[0],
            productName: name,
            type: 'add',
            quantity: quantity,
            note: 'إضافة أولية'
          };
          stockMovements.push(movement);
          localStorage.setItem('stockMovements', JSON.stringify(stockMovements));
        }
        
        updateInventoryTable();
        updateStockMovementTable();
        populateProductSelect();
        inventoryForm.reset();
      });
      
      // Stock movement form
      const stockMovementForm = document.getElementById('stockMovementForm');
      stockMovementForm.addEventListener('submit', e => {
        e.preventDefault();
        const productName = document.getElementById('movementProduct').value;
        const type = document.getElementById('movementType').value;
        const quantity = parseInt(document.getElementById('movementQuantity').value);
        const note = document.getElementById('movementNote').value.trim();
        
        if (!productName || !type || isNaN(quantity) || quantity <= 0) {
          alert('يرجى ملء جميع الحقول المطلوبة بشكل صحيح.');
          return;
        }
        
        // Check if withdrawal is possible
        if (type === 'withdraw') {
          const stockInfo = getProductCurrentStock(productName);
          if (quantity > stockInfo.currentStock) {
            alert(`لا يمكن سحب ${quantity} قطعة. المخزون الحالي: ${stockInfo.currentStock}`);
            return;
          }
        }
        
        const movement = {
          date: new Date().toISOString().split('T')[0],
          productName,
          type,
          quantity,
          note
        };
        
        stockMovements.push(movement);
        localStorage.setItem('stockMovements', JSON.stringify(stockMovements));
        
        updateInventoryTable();
        updateStockMovementTable();
        stockMovementForm.reset();
      });
      
      // Delete all movements button
      document.getElementById('deleteAllMovementsBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع حركات المخزون؟ لا يمكن التراجع عن هذا الإجراء.')) {
          stockMovements = [];
          localStorage.setItem('stockMovements', JSON.stringify(stockMovements));
          updateStockMovementTable();
          updateInventoryTable();
        }
      });
      
      // Delete all inventory button
      document.getElementById('deleteAllInventoryBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع المنتجات وحركات المخزون؟ لا يمكن التراجع عن هذا الإجراء.')) {
          inventory = [];
          stockMovements = [];
          localStorage.setItem('inventory', JSON.stringify(inventory));
          localStorage.setItem('stockMovements', JSON.stringify(stockMovements));
          updateInventoryTable();
          updateStockMovementTable();
          populateProductSelect();
        }
      });
    }

    // Expenses Functions
    function updateExpensesTable() {
      const tbody = document.getElementById('expensesTableBody');
      tbody.innerHTML = '';
      
      if (expenses.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 5;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد مصروفات مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      
      expenses.forEach((expense, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${expense.date}</td>
          <td class="px-4 py-3">${expense.category}</td>
          <td class="px-4 py-3">${parseFloat(expense.amount).toFixed(2)}</td>
          <td class="px-4 py-3">${expense.description || ''}</td>
          <td class="px-4 py-3 text-center">
            <button data-index="${index}" class="deleteExpenseBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deleteExpenseBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          expenses.splice(idx, 1);
          localStorage.setItem('expenses', JSON.stringify(expenses));
          updateExpensesTable();
        });
      });
    }

    function initializeExpenses() {
      updateExpensesTable();
      
      const expenseForm = document.getElementById('expenseForm');
      expenseForm.addEventListener('submit', e => {
        e.preventDefault();
        const date = document.getElementById('expenseDate').value;
        const category = document.getElementById('expenseCategory').value;
        const amount = parseFloat(document.getElementById('expenseAmount').value);
        const description = document.getElementById('expenseDescription').value.trim();
        
        if (!date || !category || isNaN(amount) || amount < 0) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }
        
        expenses.push({ date, category, amount, description });
        localStorage.setItem('expenses', JSON.stringify(expenses));
        updateExpensesTable();
        expenseForm.reset();
      });
      
      document.getElementById('deleteAllExpensesBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع المصروفات؟ لا يمكن التراجع عن هذا الإجراء.')) {
          expenses = [];
          localStorage.setItem('expenses', JSON.stringify(expenses));
          updateExpensesTable();
        }
      });
    }

    // Salaries Functions
    function updateSalariesTable() {
      const tbody = document.getElementById('salariesTableBody');
      tbody.innerHTML = '';
      
      if (salaries.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 6;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد رواتب مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      // Aggregate withdrawals by worker and month
      const withdrawalMap = {};
      withdrawals.forEach(wd => {
        const month = wd.date.slice(0, 7);
        const key = wd.workerId + '|' + month;
        if (!withdrawalMap[key]) withdrawalMap[key] = 0;
        withdrawalMap[key] += wd.amount;
      });

      salaries.forEach((salary, index) => {
        const workerName = workers.find(w => w.id === salary.workerId)?.name || 'غير معروف';
        const month = salary.date.slice(0, 7);
        const key = salary.workerId + '|' + month;
        const totalWithdrawal = withdrawalMap[key] || 0;
        const netSalary = salary.amount - totalWithdrawal;

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${workerName}</td>
          <td class="px-4 py-3">${salary.amount.toFixed(2)}</td>
          <td class="px-4 py-3">${totalWithdrawal.toFixed(2)}</td>
          <td class="px-4 py-3 font-semibold ${netSalary < 0 ? 'text-red-600' : 'text-green-600'}">${netSalary.toFixed(2)}</td>
          <td class="px-4 py-3">${salary.date}</td>
          <td class="px-4 py-3 text-center">
            <button data-index="${index}" class="deleteSalaryBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      document.querySelectorAll('.deleteSalaryBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          salaries.splice(idx, 1);
          localStorage.setItem('salaries', JSON.stringify(salaries));
          updateSalariesTable();
        });
      });
    }

    function initializeSalaries() {
      updateSalariesTable();
      
      const salaryForm = document.getElementById('salaryForm');
      salaryForm.addEventListener('submit', e => {
        e.preventDefault();
        const workerId = document.getElementById('salaryWorker').value;
        const amount = parseFloat(document.getElementById('salaryAmount').value);
        const date = document.getElementById('salaryDate').value;
        
        if (!workerId || isNaN(amount) || amount < 0 || !date) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }
        
        salaries.push({ workerId, amount, date });
        localStorage.setItem('salaries', JSON.stringify(salaries));
        updateSalariesTable();
        salaryForm.reset();
      });
      
      document.getElementById('deleteAllSalariesBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع الرواتب؟ لا يمكن التراجع عن هذا الإجراء.')) {
          salaries = [];
          localStorage.setItem('salaries', JSON.stringify(salaries));
          updateSalariesTable();
        }
      });
    }

    // Withdrawals Functions
    function updateWithdrawalsTable() {
      const tbody = document.getElementById('withdrawalsTableBody');
      tbody.innerHTML = '';
      
      if (withdrawals.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 4;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد عمليات سحب مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        document.getElementById('monthlyWithdrawalSummary').classList.add('hidden');
        return;
      }
      
      withdrawals.forEach((withdrawal, index) => {
        const workerName = workers.find(w => w.id === withdrawal.workerId)?.name || 'غير معروف';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${withdrawal.date}</td>
          <td class="px-4 py-3">${workerName}</td>
          <td class="px-4 py-3">${parseFloat(withdrawal.amount).toFixed(2)}</td>
          <td class="px-4 py-3 text-center">
            <button data-index="${index}" class="deleteWithdrawalBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deleteWithdrawalBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          withdrawals.splice(idx, 1);
          localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
          updateWithdrawalsTable();
          updateSalariesTable();
        });
      });
    }

    function calculateMonthlyWithdrawals() {
      const withdrawalTotals = {};
      withdrawals.forEach(wd => {
        const month = wd.date.slice(0, 7);
        const key = wd.workerId + '|' + month;
        if (!withdrawalTotals[key]) withdrawalTotals[key] = 0;
        withdrawalTotals[key] += wd.amount;
      });

      const content = document.getElementById('monthlyWithdrawalContent');
      content.innerHTML = '';
      
      for (const key in withdrawalTotals) {
        const [workerId, month] = key.split('|');
        const workerName = workers.find(w => w.id === workerId)?.name || 'غير معروف';
        const amount = withdrawalTotals[key];
        
        const div = document.createElement('div');
        div.className = 'flex justify-between items-center py-2 border-b border-red-200';
        div.innerHTML = `
          <span class="font-semibold">${workerName} - ${month}</span>
          <span class="font-bold">${amount.toFixed(2)} ريال</span>
        `;
        content.appendChild(div);
      }
      
      document.getElementById('monthlyWithdrawalSummary').classList.remove('hidden');
    }

    function initializeWithdrawals() {
      updateWithdrawalsTable();
      
      const withdrawalForm = document.getElementById('withdrawalForm');
      withdrawalForm.addEventListener('submit', e => {
        e.preventDefault();
        const date = document.getElementById('withdrawalDate').value;
        const workerId = document.getElementById('withdrawalWorker').value;
        const amount = parseFloat(document.getElementById('withdrawalAmount').value);
        
        if (!date || !workerId || isNaN(amount) || amount < 0) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }
        
        withdrawals.push({ date, workerId, amount });
        localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
        updateWithdrawalsTable();
        updateSalariesTable();
        withdrawalForm.reset();
      });
      
      document.getElementById('calculateMonthlyWithdrawalsBtn').addEventListener('click', calculateMonthlyWithdrawals);
      
      document.getElementById('deleteAllWithdrawalsBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع عمليات السحب؟ لا يمكن التراجع عن هذا الإجراء.')) {
          withdrawals = [];
          localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
          updateWithdrawalsTable();
          updateSalariesTable();
        }
      });
    }

    // Appointments Functions
    function updateAppointmentsTable() {
      const tbody = document.getElementById('appointmentsTableBody');
      tbody.innerHTML = '';
      
      if (appointments.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 4;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد مواعيد مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      
      appointments.forEach((appointment, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${appointment.date}</td>
          <td class="px-4 py-3">${appointment.time}</td>
          <td class="px-4 py-3">${appointment.customer}</td>
          <td class="px-4 py-3 text-center">
            <button data-index="${index}" class="deleteAppointmentBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deleteAppointmentBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          appointments.splice(idx, 1);
          localStorage.setItem('appointments', JSON.stringify(appointments));
          updateAppointmentsTable();
        });
      });
    }

    function initializeAppointments() {
      updateAppointmentsTable();
      
      const appointmentForm = document.getElementById('appointmentForm');
      appointmentForm.addEventListener('submit', e => {
        e.preventDefault();
        const date = document.getElementById('appointmentDate').value;
        const time = document.getElementById('appointmentTime').value;
        const customer = document.getElementById('appointmentCustomer').value.trim();
        
        if (!date || !time || !customer) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }
        
        appointments.push({ date, time, customer });
        localStorage.setItem('appointments', JSON.stringify(appointments));
        updateAppointmentsTable();
        appointmentForm.reset();
      });
      
      document.getElementById('deleteAllAppointmentsBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع المواعيد؟ لا يمكن التراجع عن هذا الإجراء.')) {
          appointments = [];
          localStorage.setItem('appointments', JSON.stringify(appointments));
          updateAppointmentsTable();
        }
      });
    }

    // Services Functions
    function updateServicesTable() {
      const tbody = document.getElementById('servicesTableBody');
      tbody.innerHTML = '';
      
      if (servicesData.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 3;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد خدمات مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      
      servicesData.forEach((service, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${service.name}</td>
          <td class="px-4 py-3">${parseFloat(service.price).toFixed(2)}</td>
          <td class="px-4 py-3 text-center">
            <button data-index="${index}" class="deleteServiceBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deleteServiceBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          servicesData.splice(idx, 1);
          localStorage.setItem('services', JSON.stringify(servicesData));
          updateServicesTable();
        });
      });
    }

    function initializeServices() {
      updateServicesTable();
      
      const serviceForm = document.getElementById('serviceForm');
      serviceForm.addEventListener('submit', e => {
        e.preventDefault();
        const name = document.getElementById('serviceName').value.trim();
        const price = parseFloat(document.getElementById('servicePriceInput').value);
        
        if (!name || isNaN(price) || price < 0) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }
        
        servicesData.push({ name, price });
        localStorage.setItem('services', JSON.stringify(servicesData));
        updateServicesTable();
        serviceForm.reset();
      });
      
      document.getElementById('deleteAllServicesBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع الخدمات؟ لا يمكن التراجع عن هذا الإجراء.')) {
          servicesData = [];
          localStorage.setItem('services', JSON.stringify(servicesData));
          updateServicesTable();
        }
      });
    }

    // Reports Functions
    function updateReports() {
      // Expenses report
      const expenseReportBody = document.getElementById('expenseReportBody');
      const totalExpensesSpan = document.getElementById('totalExpenses');
      const expenseCategoryTotals = {};
      
      expenses.forEach(exp => {
        if (!expenseCategoryTotals[exp.category]) expenseCategoryTotals[exp.category] = 0;
        expenseCategoryTotals[exp.category] += exp.amount;
      });
      
      expenseReportBody.innerHTML = '';
      let totalExpenses = 0;
      
      for (const cat in expenseCategoryTotals) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${cat}</td>
          <td class="px-4 py-3">${expenseCategoryTotals[cat].toFixed(2)}</td>
        `;
        expenseReportBody.appendChild(tr);
        totalExpenses += expenseCategoryTotals[cat];
      }
      
      totalExpensesSpan.textContent = totalExpenses.toFixed(2);

      // Salaries report
      const salaryReportBody = document.getElementById('salaryReportBody');
      const totalSalariesSpan = document.getElementById('totalSalaries');
      const salaryTotals = {};
      
      salaries.forEach(sal => {
        if (!salaryTotals[sal.workerId]) salaryTotals[sal.workerId] = 0;
        salaryTotals[sal.workerId] += sal.amount;
      });
      
      salaryReportBody.innerHTML = '';
      let totalSalariesAmount = 0;
      
      for (const workerId in salaryTotals) {
        const workerName = workers.find(w => w.id === workerId)?.name || 'غير معروف';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${workerName}</td>
          <td class="px-4 py-3">${salaryTotals[workerId].toFixed(2)}</td>
        `;
        salaryReportBody.appendChild(tr);
        totalSalariesAmount += salaryTotals[workerId];
      }
      
      totalSalariesSpan.textContent = totalSalariesAmount.toFixed(2);

      // Withdrawals report
      const withdrawalReportBody = document.getElementById('withdrawalReportBody');
      const totalWithdrawalsSpan = document.getElementById('totalWithdrawals');
      const withdrawalTotals = {};
      
      withdrawals.forEach(wd => {
        const month = wd.date.slice(0, 7);
        const key = wd.workerId + '|' + month;
        if (!withdrawalTotals[key]) withdrawalTotals[key] = 0;
        withdrawalTotals[key] += wd.amount;
      });
      
      withdrawalReportBody.innerHTML = '';
      let totalWithdrawalsAmount = 0;
      
      for (const key in withdrawalTotals) {
        const [workerId, month] = key.split('|');
        const workerName = workers.find(w => w.id === workerId)?.name || 'غير معروف';
        const amount = withdrawalTotals[key];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${workerName}</td>
          <td class="px-4 py-3">${month}</td>
          <td class="px-4 py-3">${amount.toFixed(2)}</td>
        `;
        withdrawalReportBody.appendChild(tr);
        totalWithdrawalsAmount += amount;
      }
      
      totalWithdrawalsSpan.textContent = totalWithdrawalsAmount.toFixed(2);

      // Invoices report
      updateInvoicesReport();
    }

    function updateInvoicesReport() {
      const invoiceStats = printedInvoices.reduce((acc, invoice) => {
        const total = parseFloat(invoice.total);
        acc.totalInvoices += 1;
        acc.totalAmount += total;
        if (invoice.paymentMethod === 'cash') {
          acc.cashAmount += total;
        } else if (invoice.paymentMethod === 'visa') {
          acc.visaAmount += total;
        }
        return acc;
      }, { totalInvoices: 0, totalAmount: 0, cashAmount: 0, visaAmount: 0 });

      document.getElementById('totalInvoicesCount').textContent = invoiceStats.totalInvoices;
      document.getElementById('totalInvoicesAmount').textContent = invoiceStats.totalAmount.toFixed(2) + ' ريال';
      document.getElementById('totalCashInvoices').textContent = invoiceStats.cashAmount.toFixed(2) + ' ريال';
      document.getElementById('totalVisaInvoices').textContent = invoiceStats.visaAmount.toFixed(2) + ' ريال';

      // Invoice worker totals
      const invoiceWorkerTotals = printedInvoices.reduce((acc, invoice) => {
        const workerName = invoice.worker || 'غير محدد';
        acc[workerName] = (acc[workerName] || 0) + parseFloat(invoice.total);
        return acc;
      }, {});

      const invoiceWorkerReportBody = document.getElementById('invoiceWorkerReportBody');
      invoiceWorkerReportBody.innerHTML = '';

      for (const workerName in invoiceWorkerTotals) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-4 py-3">${workerName}</td>
          <td class="px-4 py-3">${invoiceWorkerTotals[workerName].toFixed(2)}</td>
        `;
        invoiceWorkerReportBody.appendChild(tr);
      }
    }

    function printAllReports() {
      // Calculate all totals
      const expenseCategoryTotals = {};
      expenses.forEach(exp => {
        if (!expenseCategoryTotals[exp.category]) expenseCategoryTotals[exp.category] = 0;
        expenseCategoryTotals[exp.category] += exp.amount;
      });
      const totalExpenses = Object.values(expenseCategoryTotals).reduce((sum, amount) => sum + amount, 0);

      const salaryTotals = {};
      salaries.forEach(sal => {
        if (!salaryTotals[sal.workerId]) salaryTotals[sal.workerId] = 0;
        salaryTotals[sal.workerId] += sal.amount;
      });
      const totalSalaries = Object.values(salaryTotals).reduce((sum, amount) => sum + amount, 0);

      const withdrawalTotals = {};
      withdrawals.forEach(wd => {
        const month = wd.date.slice(0, 7);
        const key = wd.workerId + '|' + month;
        if (!withdrawalTotals[key]) withdrawalTotals[key] = 0;
        withdrawalTotals[key] += wd.amount;
      });
      const totalWithdrawals = Object.values(withdrawalTotals).reduce((sum, amount) => sum + amount, 0);

      const invoiceStats = printedInvoices.reduce((acc, invoice) => {
        const total = parseFloat(invoice.total);
        acc.totalInvoices += 1;
        acc.totalAmount += total;
        if (invoice.paymentMethod === 'cash') {
          acc.cashAmount += total;
        } else if (invoice.paymentMethod === 'visa') {
          acc.visaAmount += total;
        }
        return acc;
      }, { totalInvoices: 0, totalAmount: 0, cashAmount: 0, visaAmount: 0 });

      const invoiceWorkerTotals = printedInvoices.reduce((acc, invoice) => {
        const workerName = invoice.worker || 'غير محدد';
        acc[workerName] = (acc[workerName] || 0) + parseFloat(invoice.total);
        return acc;
      }, {});

      const printContent = `
        <div class="printable-content">
          <div style="text-align: center; margin-bottom: 20px;">
            <h1 style="font-size: 24px; font-weight: bold;">مركز الفارس للعناية بالرجل</h1>
            <h2 style="font-size: 20px; margin-top: 10px;">تقرير شامل</h2>
            <p style="margin-top: 10px;">التاريخ: ${new Date().toLocaleDateString('ar-EG')}</p>
          </div>

          <div style="margin-bottom: 30px;">
            <h3 style="font-size: 18px; font-weight: bold; border-bottom: 2px solid #000; padding-bottom: 5px;">تقرير المصروفات</h3>
            <p style="margin: 10px 0;">إجمالي المصروفات: ${totalExpenses.toFixed(2)} ريال</p>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
              <thead>
                <tr style="background-color: #f0f0f0;">
                  <th style="border: 1px solid #000; padding: 8px;">الفئة</th>
                  <th style="border: 1px solid #000; padding: 8px;">المبلغ (ريال)</th>
                </tr>
              </thead>
              <tbody>
                ${Object.entries(expenseCategoryTotals).map(([category, amount]) => 
                  `<tr>
                    <td style="border: 1px solid #000; padding: 8px;">${category}</td>
                    <td style="border: 1px solid #000; padding: 8px;">${amount.toFixed(2)}</td>
                  </tr>`
                ).join('')}
              </tbody>
            </table>
          </div>

          <div style="margin-bottom: 30px;">
            <h3 style="font-size: 18px; font-weight: bold; border-bottom: 2px solid #000; padding-bottom: 5px;">تقرير الرواتب</h3>
            <p style="margin: 10px 0;">إجمالي الرواتب المدفوعة: ${totalSalaries.toFixed(2)} ريال</p>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
              <thead>
                <tr style="background-color: #f0f0f0;">
                  <th style="border: 1px solid #000; padding: 8px;">اسم الموظف</th>
                  <th style="border: 1px solid #000; padding: 8px;">المبلغ (ريال)</th>
                </tr>
              </thead>
              <tbody>
                ${Object.entries(salaryTotals).map(([workerId, amount]) => {
                  const workerName = workers.find(w => w.id === workerId)?.name || 'غير معروف';
                  return `<tr>
                    <td style="border: 1px solid #000; padding: 8px;">${workerName}</td>
                    <td style="border: 1px solid #000; padding: 8px;">${amount.toFixed(2)}</td>
                  </tr>`;
                }).join('')}
              </tbody>
            </table>
          </div>

          <div style="margin-bottom: 30px;">
            <h3 style="font-size: 18px; font-weight: bold; border-bottom: 2px solid #000; padding-bottom: 5px;">تقرير السحب</h3>
            <p style="margin: 10px 0;">إجمالي السحب: ${totalWithdrawals.toFixed(2)} ريال</p>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
              <thead>
                <tr style="background-color: #f0f0f0;">
                  <th style="border: 1px solid #000; padding: 8px;">اسم العامل</th>
                  <th style="border: 1px solid #000; padding: 8px;">الشهر</th>
                  <th style="border: 1px solid #000; padding: 8px;">المبلغ (ريال)</th>
                </tr>
              </thead>
              <tbody>
                ${Object.entries(withdrawalTotals).map(([key, amount]) => {
                  const [workerId, month] = key.split('|');
                  const workerName = workers.find(w => w.id === workerId)?.name || 'غير معروف';
                  return `<tr>
                    <td style="border: 1px solid #000; padding: 8px;">${workerName}</td>
                    <td style="border: 1px solid #000; padding: 8px;">${month}</td>
                    <td style="border: 1px solid #000; padding: 8px;">${amount.toFixed(2)}</td>
                  </tr>`;
                }).join('')}
              </tbody>
            </table>
          </div>

          <div style="margin-bottom: 30px;">
            <h3 style="font-size: 18px; font-weight: bold; border-bottom: 2px solid #000; padding-bottom: 5px;">تقرير الفواتير</h3>
            <p style="margin: 10px 0;">عدد الفواتير: ${invoiceStats.totalInvoices}</p>
            <p style="margin: 10px 0;">إجمالي مبيعات الفواتير: ${invoiceStats.totalAmount.toFixed(2)} ريال</p>
            <p style="margin: 10px 0;">المبالغ المدفوعة كاش: ${invoiceStats.cashAmount.toFixed(2)} ريال</p>
            <p style="margin: 10px 0;">المبالغ المدفوعة فيزا: ${invoiceStats.visaAmount.toFixed(2)} ريال</p>
            
            <h4 style="font-size: 16px; font-weight: bold; margin-top: 20px;">مبيعات حسب العامل:</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
              <thead>
                <tr style="background-color: #f0f0f0;">
                  <th style="border: 1px solid #000; padding: 8px;">اسم العامل</th>
                  <th style="border: 1px solid #000; padding: 8px;">إجمالي المبيعات (ريال)</th>
                </tr>
              </thead>
              <tbody>
                ${Object.entries(invoiceWorkerTotals).map(([workerName, amount]) => 
                  `<tr>
                    <td style="border: 1px solid #000; padding: 8px;">${workerName}</td>
                    <td style="border: 1px solid #000; padding: 8px;">${amount.toFixed(2)}</td>
                  </tr>`
                ).join('')}
              </tbody>
            </table>
          </div>

          <div style="margin-top: 30px; border-top: 2px solid #000; padding-top: 10px; text-align: center;">
            <p style="font-size: 14px; color: #666;">© 2025 جميع الحقوق محفوظة | تصميم وتطوير بواسطة Eng-A7med-ra</p>
          </div>
        </div>
      `;

      const printWindow = window.open('', '_blank');
      if (printWindow) {
        printWindow.document.write(`
          <html dir="rtl">
            <head>
              <title>تقرير شامل - مركز الفارس</title>
              <style>
                body { font-family: 'Cairo', Arial, sans-serif; direction: rtl; margin: 0; padding: 20px; }
                .printable-content { max-width: 800px; margin: 0 auto; }
                @media print {
                  body { margin: 0; padding: 10px; }
                  .printable-content { max-width: none; }
                }
              </style>
            </head>
            <body>${printContent}</body>
          </html>
        `);
        printWindow.document.close();
        printWindow.print();
      }
    }

    function initializeReports() {
      document.getElementById('printAllReportsBtn').addEventListener('click', printAllReports);
    }

    // Daily Salary Functions
    function calculateAndDisplayDailySalary(workerId, date) {
      const filteredInvoices = printedInvoices.filter(inv => {
        if (!inv.worker) return false;
        const invWorker = workers.find(w => w.name === inv.worker);
        if (!invWorker) return false;
        if (invWorker.id !== workerId) return false;
        
        const invDateObj = new Date(inv.date);
        const invDateStr = invDateObj.getFullYear() + '-' + 
                          String(invDateObj.getMonth() + 1).padStart(2, '0') + '-' + 
                          String(invDateObj.getDate()).padStart(2, '0');
        return invDateStr === date;
      });

      let totalServicesSalary = 0;
      filteredInvoices.forEach(inv => {
        totalServicesSalary += parseFloat(inv.total);
      });

      const totalWithdrawals = withdrawals.reduce((sum, wd) => {
        if (wd.workerId === workerId && wd.date === date) {
          return sum + parseFloat(wd.amount);
        }
        return sum;
      }, 0);

      const netSalary = totalServicesSalary - totalWithdrawals;

      document.getElementById('dailySalaryText').textContent = 
        `العامل: ${workers.find(w => w.id === workerId)?.name || 'غير معروف'}\n` +
        `التاريخ: ${date}\n` +
        `إجمالي رواتب الخدمات: ${totalServicesSalary.toFixed(2)} ريال\n` +
        `إجمالي السحب: ${totalWithdrawals.toFixed(2)} ريال\n` +
        `صافي الراتب: ${netSalary.toFixed(2)} ريال`;

      document.getElementById('dailySalaryResult').classList.remove('hidden');
    }

    function autoDisplayDailySalary() {
      if (printedInvoices.length === 0) {
        document.getElementById('dailySalaryText').textContent = 'لا توجد فواتير مسجلة لعرض الراتب اليومي.';
        document.getElementById('dailySalaryResult').classList.remove('hidden');
        document.getElementById('dailyWorkerSelect').value = "";
        document.getElementById('dailyDateInput').value = "";
        return;
      }

      let firstInvoice = null;
      for (let inv of printedInvoices) {
        if (inv.worker && inv.date) {
          const invWorker = workers.find(w => w.name === inv.worker);
          if (invWorker) {
            firstInvoice = inv;
            break;
          }
        }
      }

      if (!firstInvoice) {
        document.getElementById('dailySalaryText').textContent = 'لا توجد فواتير صالحة لعرض الراتب اليومي.';
        document.getElementById('dailySalaryResult').classList.remove('hidden');
        document.getElementById('dailyWorkerSelect').value = "";
        document.getElementById('dailyDateInput').value = "";
        return;
      }

      const invWorker = workers.find(w => w.name === firstInvoice.worker);
      const invDateObj = new Date(firstInvoice.date);
      const invDateStr = invDateObj.getFullYear() + '-' + 
                        String(invDateObj.getMonth() + 1).padStart(2, '0') + '-' + 
                        String(invDateObj.getDate()).padStart(2, '0');

      document.getElementById('dailyWorkerSelect').value = invWorker.id;
      document.getElementById('dailyDateInput').value = invDateStr;

      calculateAndDisplayDailySalary(invWorker.id, invDateStr);
    }

    function initializeDailySalary() {
      const dailySalaryForm = document.getElementById('dailySalaryForm');
      dailySalaryForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const workerId = document.getElementById('dailyWorkerSelect').value;
        const date = document.getElementById('dailyDateInput').value;

        if (!workerId || !date) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }

        calculateAndDisplayDailySalary(workerId, date);
      });

      document.getElementById('deleteAllDailySalaryBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع بيانات الراتب اليومي؟ (سيتم مسح الفواتير المخزنة)')) {
          localStorage.removeItem('salon_printed_invoices');
          printedInvoices = [];
          document.getElementById('dailySalaryText').textContent = 'تم مسح بيانات الراتب اليومي.';
          document.getElementById('dailySalaryResult').classList.remove('hidden');
        }
      });
    }

    // Monthly Salary Functions
    function initializeMonthlySalary() {
      const monthlySalaryForm = document.getElementById('monthlySalaryForm');
      monthlySalaryForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const workerId = document.getElementById('monthlyWorkerSelect').value;
        const year = document.getElementById('monthlyYearInput').value;
        const month = document.getElementById('monthlyMonthInput').value;

        if (!workerId || !year || !month) {
          alert('يرجى ملء جميع الحقول بشكل صحيح.');
          return;
        }

        const filteredInvoices = printedInvoices.filter(inv => {
          if (!inv.worker) return false;
          const invWorker = workers.find(w => w.name === inv.worker);
          if (!invWorker) return false;
          if (invWorker.id !== workerId) return false;
          const invDate = new Date(inv.date);
          return invDate.getFullYear() === parseInt(year) && (invDate.getMonth() + 1) === parseInt(month);
        });

        let totalServicesSalary = 0;
        filteredInvoices.forEach(inv => {
          totalServicesSalary += parseFloat(inv.total);
        });

        const totalWithdrawals = withdrawals.reduce((sum, wd) => {
          if (wd.workerId === workerId && wd.date.startsWith(`${year}-${month}`)) {
            return sum + parseFloat(wd.amount);
          }
          return sum;
        }, 0);

        const netSalary = totalServicesSalary - totalWithdrawals;

        document.getElementById('monthlySalaryText').textContent = 
          `العامل: ${workers.find(w => w.id === workerId)?.name || 'غير معروف'}\n` +
          `الشهر: ${year}-${month}\n` +
          `إجمالي رواتب الخدمات: ${totalServicesSalary.toFixed(2)} ريال\n` +
          `إجمالي السحب: ${totalWithdrawals.toFixed(2)} ريال\n` +
          `صافي الراتب: ${netSalary.toFixed(2)} ريال`;

        document.getElementById('monthlySalaryResult').classList.remove('hidden');
      });

      document.getElementById('deleteAllMonthlySalaryBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع بيانات الراتب الشهري؟ (سيتم مسح الفواتير المخزنة)')) {
          localStorage.removeItem('salon_printed_invoices');
          printedInvoices = [];
          document.getElementById('monthlySalaryText').textContent = 'تم مسح بيانات الراتب الشهري.';
          document.getElementById('monthlySalaryResult').classList.remove('hidden');
        }
      });
    }

    // Payment Summary Functions
    function updatePaymentSummary() {
      let totalCash = 0;
      let totalVisa = 0;
      
      printedInvoices.forEach(inv => {
        const total = parseFloat(inv.total) || 0;
        if (inv.paymentMethod === 'cash') {
          totalCash += total;
        } else if (inv.paymentMethod === 'visa') {
          totalVisa += total;
        }
      });
      
      document.getElementById('totalCashAmount').textContent = totalCash.toFixed(2) + ' ريال';
      document.getElementById('totalVisaAmount').textContent = totalVisa.toFixed(2) + ' ريال';
      document.getElementById('totalCashAmountTable').textContent = totalCash.toFixed(2);
      document.getElementById('totalVisaAmountTable').textContent = totalVisa.toFixed(2);
    }

    // POS System Functions
    function renderProductGrid() {
      const grid = document.getElementById("productGrid");
      grid.innerHTML = "";
      const productsToShow = showAll ? allProducts : allProducts.slice(0, 6);
      
      productsToShow.forEach((product) => {
        const btn = document.createElement("button");
        btn.className = "bg-white rounded-lg border border-gray-300 p-2 flex flex-col items-center text-xs text-center hover:border-blue-500 hover:shadow-md transition-all duration-200";
        btn.title = product.name;
        btn.onclick = () => addProductToInvoice(product.name, 1, product.price);
        btn.innerHTML = `
          <img alt="${product.alt}" class="mb-2 w-12 h-12 object-cover rounded" src="${product.img}" />
          <span class="text-xs font-medium">${product.name}</span>
          <span class="text-xs text-green-600 font-bold">${product.price} ريال</span>
        `;
        grid.appendChild(btn);
      });
      
      const showMoreBtn = document.getElementById("showMoreBtn");
      showMoreBtn.textContent = showAll ? "عرض أقل" : "عرض المزيد";
    }

    function addProductToInvoice(name, quantity, price) {
      const existingIndex = invoiceItems.findIndex(item => item.name === name);
      if (existingIndex !== -1) {
        invoiceItems[existingIndex].quantity += quantity;
        invoiceItems[existingIndex].price = price;
      } else {
        invoiceItems.push({ name, quantity, price, discount: 0 });
      }
      renderInvoice();
    }

    function renderInvoice() {
      const container = document.getElementById("invoiceItems");
      container.innerHTML = "";
      
      invoiceItems.forEach((item, index) => {
        const totalPrice = (item.price * item.quantity * (1 - item.discount / 100)).toFixed(2);
        const row = document.createElement("div");
        row.className = "grid grid-cols-6 gap-2 items-center text-sm text-gray-800 border-b border-gray-200 py-2";
        row.innerHTML = `
          <div class="text-xs">${item.name}</div>
          <div>
            <input type="number" min="1" value="${item.quantity}" class="w-full border border-gray-300 rounded text-xs text-center p-1" data-index="${index}" data-type="quantity" />
          </div>
          <div>
            <input type="number" min="0" step="0.01" value="${item.price.toFixed(2)}" class="w-full border border-gray-300 rounded text-xs text-center p-1" data-index="${index}" data-type="price" />
          </div>
          <div>
            <input type="number" min="0" max="100" value="${item.discount}" class="w-full border border-gray-300 rounded text-xs text-center p-1" data-index="${index}" data-type="discount" />
          </div>
          <div class="text-xs font-semibold">${totalPrice}</div>
          <div>
            <button class="text-red-500 text-lg font-bold hover:text-red-700 transition" data-index="${index}" data-action="remove">×</button>
          </div>
        `;
        container.appendChild(row);
      });
      
      updateTotal();
      attachInputListeners();
    }

    function attachInputListeners() {
      const container = document.getElementById("invoiceItems");
      
      container.querySelectorAll("input").forEach((input) => {
        input.oninput = (e) => {
          const index = +e.target.getAttribute("data-index");
          const type = e.target.getAttribute("data-type");
          
          if (type === "quantity") {
            let val = parseInt(e.target.value);
            if (isNaN(val) || val < 1) val = 1;
            invoiceItems[index].quantity = val;
          } else if (type === "price") {
            let val = parseFloat(e.target.value);
            if (isNaN(val) || val < 0) val = 0;
            invoiceItems[index].price = val;
          } else if (type === "discount") {
            let val = parseInt(e.target.value);
            if (isNaN(val) || val < 0) val = 0;
            if (val > 100) val = 100;
            invoiceItems[index].discount = val;
          }
          renderInvoice();
        };
      });
      
      container.querySelectorAll("button[data-action='remove']").forEach((btn) => {
        btn.onclick = (e) => {
          if (!confirmPasswordPrompt()) return;
          const index = +e.target.getAttribute("data-index");
          invoiceItems.splice(index, 1);
          renderInvoice();
        };
      });
    }

    function updateTotal() {
      const totalEl = document.getElementById("totalAmount");
      const total = invoiceItems.reduce((sum, item) => {
        return sum + item.price * item.quantity * (1 - item.discount / 100);
      }, 0);
      totalEl.textContent = `المجموع: ${total.toFixed(2)} ريال`;
    }

    function clearInvoice() {
      if (!confirmPasswordPrompt()) return;
      if (confirm("هل أنت متأكد من إلغاء الفاتورة؟")) {
        invoiceItems = [];
        renderInvoice();
        document.getElementById("workerName").value = "";
        document.getElementById("customerName").value = "";
        document.getElementById("paymentMethod").value = "cash";
      }
    }

    function completeSaleAndPrint() {
      if (invoiceItems.length === 0) {
        alert("لا توجد منتجات أو خدمات في الفاتورة.");
        return;
      }
      
      const worker = document.getElementById("workerName").value.trim();
      if (!worker) {
        alert("يرجى كتابة اسم العامل قبل إتمام البيع.");
        document.getElementById("workerName").focus();
        return;
      }
      
      const paymentMethod = document.getElementById("paymentMethod").value;
      printInvoice(paymentMethod);
      alert("تم إتمام البيع بنجاح!\nشكراً لاستخدامك نظام مركز الفارس.");
      
      invoiceItems = [];
      renderInvoice();
      document.getElementById("workerName").value = "";
      document.getElementById("customerName").value = "";
      document.getElementById("paymentMethod").value = "cash";
    }

    function printInvoice(paymentMethod) {
      const worker = document.getElementById("workerName").value.trim() || "غير محدد";
      const customer = document.getElementById("customerName").value.trim() || "عميل عابر";
      const receiptDiv = document.getElementById("printableReceipt");
      
      let receiptText = "";
      receiptText += "مركز الفارس للعناية بالرجل\n";
      receiptText += "------------------------------\n";
      const date = new Date();
      receiptText += `التاريخ: ${date.toLocaleDateString("ar-EG")} - الوقت: ${date.toLocaleTimeString("ar-EG")}\n`;
      receiptText += `العامل: ${worker}\n`;
      receiptText += `العميل: ${customer}\n`;
      receiptText += `طريقة الدفع: ${paymentMethod === 'cash' ? 'كاش' : 'فيزا'}\n`;
      receiptText += "------------------------------\n";
      
      invoiceItems.forEach(item => {
        const totalPrice = (item.price * item.quantity * (1 - item.discount / 100)).toFixed(2);
        receiptText += `${item.name} x${item.quantity} - ${item.price.toFixed(2)} ريال\n`;
        if (item.discount > 0) {
          receiptText += `  خصم: ${item.discount}%\n`;
        }
        receiptText += `  الإجمالي: ${totalPrice} ريال\n`;
        receiptText += "------------------------------\n";
      });
      
      const total = invoiceItems.reduce((sum, item) => {
        return sum + item.price * item.quantity * (1 - item.discount / 100);
      }, 0);
      
      receiptText += `المجموع: ${total.toFixed(2)} ريال\n`;
      receiptText += "\nشكراً لزيارتكم مركز الفارس \n";

      receiptDiv.textContent = receiptText;

      // Save printed invoice
      const printedInvoice = {
        id: Date.now(),
        date: date.toISOString(),
        worker,
        customer,
        items: JSON.parse(JSON.stringify(invoiceItems)),
        total: total.toFixed(2),
        paymentMethod
      };
      
      printedInvoices.push(printedInvoice);
      localStorage.setItem("salon_printed_invoices", JSON.stringify(printedInvoices));

      receiptDiv.classList.remove("hidden");
      window.print();
      receiptDiv.classList.add("hidden");
    }

    function filterProducts() {
      const filter = document.getElementById("searchInput").value.trim();
      const grid = document.getElementById("productGrid");
      const buttons = grid.querySelectorAll("button");
      
      buttons.forEach((btn) => {
        const text = btn.textContent.trim();
        if (text.includes(filter)) {
          btn.style.display = "flex";
        } else {
          btn.style.display = "none";
        }
      });
    }

    function renderInvoiceLog() {
      const tbody = document.getElementById('invoiceLogTableBody');
      tbody.innerHTML = '';
      
      if (printedInvoices.length === 0) {
        const tr = document.createElement('tr');
        const td = document.createElement('td');
        td.colSpan = 8;
        td.className = 'text-center py-4 text-gray-500';
        td.textContent = 'لا توجد فواتير مسجلة.';
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      
      printedInvoices.forEach((inv, idx) => {
        const tr = document.createElement('tr');
        const dateObj = new Date(inv.date);
        const formattedDate = dateObj.toLocaleDateString('ar-EG') + ' ' + dateObj.toLocaleTimeString('ar-EG');
        tr.innerHTML = `
          <td class="px-3 py-2">${inv.id}</td>
          <td class="px-3 py-2">${formattedDate}</td>
          <td class="px-3 py-2">${inv.worker}</td>
          <td class="px-3 py-2">${inv.customer}</td>
          <td class="px-3 py-2 text-center">${inv.items.length}</td>
          <td class="px-3 py-2 text-center">${parseFloat(inv.total).toFixed(2)}</td>
          <td class="px-3 py-2 text-center">${inv.paymentMethod === 'cash' ? 'كاش' : 'فيزا'}</td>
          <td class="px-3 py-2 text-center">
            <button data-index="${idx}" class="deleteInvoiceBtn text-red-600 hover:text-red-800 focus:outline-none">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      document.querySelectorAll('.deleteInvoiceBtn').forEach(btn => {
        btn.addEventListener('click', e => {
          if (!confirmPasswordPrompt()) return;
          const idx = e.currentTarget.getAttribute('data-index');
          if (confirm('هل أنت متأكد من حذف هذه الفاتورة؟ لا يمكن التراجع عن هذا الإجراء.')) {
            printedInvoices.splice(idx, 1);
            localStorage.setItem("salon_printed_invoices", JSON.stringify(printedInvoices));
            renderInvoiceLog();
          }
        });
      });
    }

    function initializePOS() {
      renderInvoice();
      renderProductGrid();
      
      // Search functionality
      document.getElementById("searchInput").addEventListener('input', filterProducts);
      
      // Show more/less button
      document.getElementById("showMoreBtn").addEventListener('click', () => {
        showAll = !showAll;
        renderProductGrid();
      });
      
      // Add product by name
      document.getElementById("addProductByNameBtn").addEventListener('click', () => {
        const input = document.getElementById("addProductInput");
        const priceInput = document.getElementById("manualPriceInput");
        const name = input.value.trim();
        let price = parseFloat(priceInput.value);
        
        if (!name) {
          alert("يرجى إدخال اسم المنتج أو الخدمة.");
          return;
        }
        if (isNaN(price) || price < 0) {
          alert("يرجى إدخال سعر صالح.");
          return;
        }
        
        addProductToInvoice(name, 1, price);
        input.value = "";
        priceInput.value = "";
      });
      
      // Enter key for add product input
      document.getElementById("addProductInput").addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          document.getElementById("addProductByNameBtn").click();
        }
      });
      
      // Clear invoice button
      document.getElementById("clearInvoiceBtn").addEventListener('click', clearInvoice);
      
      // Complete sale button
      document.getElementById("completeSaleBtn").addEventListener('click', completeSaleAndPrint);
      
      // Invoice log buttons
      document.getElementById("showInvoiceLogBtn").addEventListener('click', () => {
        renderInvoiceLog();
        document.getElementById("invoiceLogSection").classList.remove('hidden');
      });
      
      document.getElementById("closeInvoiceLogBtn").addEventListener('click', () => {
        document.getElementById("invoiceLogSection").classList.add('hidden');
      });
      
      document.getElementById('deleteAllInvoicesBtn').addEventListener('click', () => {
        if (!confirmPasswordPrompt()) return;
        if (confirm('هل أنت متأكد من مسح جميع الفواتير؟ لا يمكن التراجع عن هذا الإجراء.')) {
          printedInvoices = [];
          localStorage.removeItem('salon_printed_invoices');
          renderInvoiceLog();
        }
      });
       document.getElementById('backFromPOSBtn').addEventListener('click', () => {
    document.getElementById('posSection').classList.add('hidden');
    document.getElementById('home').classList.remove('hidden');
  });
    }

    // Initialize Application
    function initializeApp() {
      // Initialize authentication
      initializeAuth();
      
      // Initialize navigation
      initializeNavigation();
      
      // Populate worker selects
      populateWorkerSelects();
      
      // Initialize all modules
      initializeExpenses();
      initializeSalaries();
      initializePayrollManagement();
      initializeWithdrawals();
      initializeAppointments();
      initializeServices();
      initializeInventory();
      initializeReports();
      initializeDailySalary();
      initializeMonthlySalary();
      initializePOS();
      
      // Show login page initially
      showLogin();
    }

    // Start the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>
